<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ff3d77" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0f0b12" media="(prefers-color-scheme: dark)">
  <title>Happy Birthday, Guddu! 🎂💖</title>
  <meta name="description" content="A lovingly crafted birthday surprise for Guddu—messages, memories, photos, videos, and lots of sparkle."/>
  <meta property="og:title" content="Happy Birthday, Guddu!"/>
  <meta property="og:description" content="Open me, Guddu! A birthday site made with love."/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="assets/cover.jpg"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    /* =========================
       Core Theme Variables
       ========================= */
    :root{
      --bg: radial-gradient(1200px 800px at 10% 10%, #ffe6f2 0%, #fff 55%, #fff 100%);
      --text:#1a1a1a;
      --muted:#666;
      --primary:#ff3d77; /* pink */
      --accent:#7c4dff;  /* purple */
      --gold:#ffb800;
      --card:#ffffffeb;
      --border: rgba(0,0,0,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.07);
      --header-h: 64px;   /* updated at runtime */
      --banner-h: 0px;    /* updated at runtime */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    [data-theme="dark"]{
      --bg: radial-gradient(1200px 800px at 10% 10%, #2a1730 0%, #0f0b12 55%, #0f0b12 100%);
      --text:#f3f3f3;
      --muted:#b7b7b7;
      --card:#16131aeb;
      --border: rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.5);
      --primary:#ff5b8a;
      --accent:#9d7cff;
      --gold:#ffd45e;
    }

    /* Box sizing + base resets */
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; }
    body{
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:var(--bg);
      min-height:100vh;
      overflow-x:hidden;
      line-height:1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    img, video{ max-width:100%; height:auto; display:block; }
    a{ color:inherit; }
    button{ font-family:inherit; }
    :focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }

    /* =========================
       Header / Navigation
       ========================= */
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(180%) blur(8px);
      background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.25));
      border-bottom:1px solid var(--border);
    }
    [data-theme="dark"] header{
      background:linear-gradient(180deg, rgba(22,19,26,.65), rgba(22,19,26,.25));
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:14px 18px; }
    .nav{ display:flex; align-items:center; gap:14px; min-height:var(--header-h); }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text) }
    .brand .logo{
      width:36px; height:36px; border-radius:50%;
      background:conic-gradient(from 90deg, var(--primary), var(--accent));
      box-shadow:0 6px 16px rgba(124,77,255,.35);
      flex:0 0 auto;
    }
    .brand span{ font-weight:800; letter-spacing:.3px; }
    .spacer{ flex:1; }

    /* Buttons */
    .btn, button.btn{
      appearance:none; border:0; padding:10px 14px; border-radius:14px;
      cursor:pointer; font-weight:600; box-shadow:var(--shadow);
      transition:transform .12s ease, box-shadow .2s ease, background .2s ease;
      text-decoration:none; display:inline-flex; align-items:center; gap:8px;
      background:var(--card); color:var(--text);
    }
    .btn-primary{ background:linear-gradient(135deg, var(--primary), var(--accent)); color:#fff; }
    .btn-ghost{ background:var(--card); color:var(--text); }
    .btn:hover{ transform:translateY(-1px); }
    .btn:active{ transform:translateY(0); }

    /* Desktop nav links */
    .nav-links{ display:flex; align-items:center; gap:10px; }
    #menuToggle{
      display:none;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:8px 10px;
      line-height:1;
    }

    /* Mobile menu panel */
    @media (max-width: 860px){
      #menuToggle{ display:inline-flex; }
      .nav-links{
        position:fixed;
        left:0; right:0;
        top:calc(var(--header-h) + var(--banner-h));
        background:var(--card);
        border-bottom:1px solid var(--border);
        box-shadow:var(--shadow);
        padding:12px 18px;
        display:none;
        flex-direction:column;
        gap:10px;
        z-index:49;
      }
      .nav-links.open{ display:flex; }
      .nav-links a, .nav-links button{ width:100%; justify-content:center; }
    }

    /* =========================
       Hero
       ========================= */
    .hero{ position:relative; padding:80px 18px 40px; }
    .hero h1{
      font-size:clamp(36px, 5vw, 64px);
      line-height:1.05;
      margin:0 0 10px; font-weight:800;
    }
    .script{
      font-family:"Great Vibes", cursive;
      font-size:clamp(28px, 4vw, 48px);
      color:var(--primary);
      filter:drop-shadow(0 8px 18px rgba(255,61,119,.2));
      white-space:nowrap;
    }
    .tag{ color:var(--muted); font-weight:400; max-width:80ch; }

    .sparkles{ position:absolute; inset:0; pointer-events:none; }

    /* =========================
       Sections / Cards
       ========================= */
    section{ scroll-margin-top:calc(var(--header-h) + var(--banner-h) + 16px); }
    .section{ padding:32px 18px; }
    .grid{ display:grid; gap:18px; }
    .grid.cards{ grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); }
    .card{
      background:var(--card); border-radius:22px; padding:18px;
      box-shadow:var(--shadow); border:1px solid var(--border);
    }
    .card h3{ margin:6px 0 10px; }
    .muted{ color:var(--muted); }

    /* Gallery */
    .gallery{ display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px; }
    .media{ position:relative; border-radius:18px; overflow:hidden; box-shadow:var(--shadow); border:1px solid var(--border); }
    .media img, .media video{ width:100%; aspect-ratio: 4/3; object-fit:cover; }
    .media .cap{
      position:absolute; left:0; right:0; bottom:0; padding:10px 12px;
      background:linear-gradient(180deg, transparent, rgba(0,0,0,.55));
      color:#fff; font-size:14px;
    }

    /* Message gradient cards */
    .gcard{ position:relative; border-radius:22px; padding:20px; overflow:hidden; box-shadow:var(--shadow); color:#fff }
    .gcard h4{ margin:0 0 8px }
    .gcard p{ margin:0 }
    .gcard::after{ content:""; position:absolute; inset:0; border-radius:inherit; border:1px solid rgba(255,255,255,.15); pointer-events:none; }
    .gcard.glow::before{
      content:""; position:absolute; inset:-2px;
      background:conic-gradient(var(--primary), var(--accent), var(--gold), var(--primary));
      filter:blur(16px); opacity:.45;
    }
    .gcard.glow > *{ position:relative }
    .gcard.soft{ background:linear-gradient(135deg, #ff6fa1, #7c4dff) }
    .gcard.sunset{ background:linear-gradient(135deg, #ffb347, #ff3d77) }
    .gcard.ocean{ background:linear-gradient(135deg, #38bdf8, #7c4dff) }

    /* Timeline */
    .timeline{ position:relative; margin:10px 0 }
    .timeline::before{ content:""; position:absolute; left:12px; top:0; bottom:0; width:3px; background:linear-gradient(var(--accent), var(--primary)) }
    .titem{ display:grid; grid-template-columns:28px 1fr; gap:12px; align-items:start; margin:12px 0 }
    .dot{ width:24px; height:24px; border-radius:50%; background:linear-gradient(135deg, var(--primary), var(--accent)); box-shadow:0 6px 14px rgba(0,0,0,.2) }
    .tcontent{ background:var(--card); padding:12px 14px; border-radius:16px; box-shadow:var(--shadow); border:1px solid var(--border) }

    /* Footer */
    footer{ padding:60px 18px; text-align:center; color:var(--muted) }

    /* Floating hearts */
    .float-heart{ position:fixed; pointer-events:none; z-index:9999; font-size:18px; animation:floatUp 3.5s ease-in forwards }
    @keyframes floatUp{
      0%{opacity:0; transform:translateY(0) scale(.8)}
      10%{opacity:1}
      100%{opacity:0; transform:translateY(-160px) scale(1.6)}
    }

    /* Modal */
    .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.45); z-index:60; padding:20px }
    .modal .dialog{ background:var(--card); padding:20px; border-radius:18px; text-align:center; box-shadow:var(--shadow); border:1px solid var(--border) }

    /* Utility */
    .center{ display:flex; align-items:center; justify-content:center }
    .row{ display:flex; gap:10px; flex-wrap:wrap }
    .hidden{ display:none }
    .mt-2{ margin-top:8px } .mt-3{ margin-top:14px } .mt-4{ margin-top:22px }

    /* Reveal headline */
    .headline-gold{
      background:linear-gradient(90deg,#ffb800,#ff6fa1,#7c4dff,#ffb800);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      font-weight:800; letter-spacing:.5px; filter:drop-shadow(0 6px 16px rgba(124,77,255,.25));
      animation:shine 3.2s linear infinite;
    }
    @keyframes shine{
      0%{background-position:0% 50%}
      100%{background-position:200% 50%}
    }

    /* Lock cards until reveal */
    #cards{ transition:opacity .6s ease, transform .6s ease; }
    #cards.locked{ opacity:.0; transform:translateY(10px); pointer-events:none; }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .btn, .headline-gold{ animation:none }
      .float-heart{ animation:none }
    }

    /* ============ Mobile Tweaks ============ */
    @media (max-width: 768px) {
      .wrap { padding: 14px 14px; }
      .nav { gap:10px; }
      .btn, button.btn { font-size: 14px; padding: 10px 12px; border-radius:14px; }
      .hero { padding: 60px 14px 24px; text-align: center; }
      .script { white-space:normal; }
      .row { flex-direction: column; align-items: stretch; }
      .grid.cards { grid-template-columns: 1fr; }
      .gallery { grid-template-columns: 1fr; }
      .media img, .media video { aspect-ratio: 16/9; }
    }

    /* Extra small screens */
    @media (max-width: 420px){
      .brand span { font-size: 16px; }
      .brand .logo { width:30px; height:30px; }
      .hero { padding-top: 48px; }
      .btn, button.btn { padding: 9px 11px; }
    }

    /* Safe-area aware bottom spacing for sticky elements */
    .sticky-bottom-pad{ padding-bottom: max(16px, calc(16px + var(--safe-bottom))); }

    /* =========================
       Cake Cutting Banner
       ========================= */
    #cakeCutBanner{
      background: linear-gradient(90deg, #ff69b4, #ff99cc);
      color: white;
      font-family: 'Poppins', sans-serif;
      padding: 0.8rem 1.2rem;
      text-align: center;
      font-size: 1rem;
      font-weight: 700;
      position: fixed;
      top: calc(var(--header-h)); /* updated via JS to add banner offset when needed */
      left: 0;
      width: 100%;
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
      z-index: 49;
      cursor: pointer;
      display: flex; justify-content: center; align-items: center;
      gap:.5rem;
      border-bottom:1px solid rgba(255,255,255,.25);
    }
    #cakeCutBanner:hover { background: linear-gradient(90deg, #ff99cc, #ff69b4); }
    #cakeCutBanner span { margin-left: 2px; }

    /* =========================
       Extra Media Queries used by other pages (safe, won't break)
       ========================= */
    @media (max-width: 980px){
      body { overflow:auto !important; }
      .stage {
        grid-template-columns: 1fr !important;
        grid-template-rows: auto auto;
        gap: 12px !important;
        height: auto !important;
        padding: 0 12px !important;
      }
      img, canvas, video { max-width: 100% !important; height: auto !important; }
    }
    @media (max-width: 640px){
      .chat { height: auto !important; max-height: none !important; }
      .chatBody {
        padding: 10px !important;
        max-height: 48vh !important;
        overflow:auto !important;
      }
      .chatFoot {
        position: sticky !important;
        bottom: 0 !important;
        background: rgba(15,11,18,.75) !important;
        backdrop-filter: blur(6px) saturate(140%) !important;
        padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px)) !important;
      }
      .chatFoot input {
        padding: 12px !important;
        min-height: 44px !important;
        font-size: 16px !important;
      }
      #knife { width: clamp(110px, 34vw, 160px) !important; z-index: 12 !important; }
      .overlayNote { font-size: 12px !important; padding: 6px 10px !important; }
      .legend { font-size: 12px !important; padding: 8px 10px !important; }
    }
  </style>
<!-- Open Graph (for WhatsApp / Facebook) -->
<meta property="og:title" content="Guddu Birthday Special 🎂" />
<meta property="og:description" content="Tap to open a surprise birthday website for Guddu! 🥳" />
<meta property="og:image" content="https://anuj1-web.github.io/Guddu-birthday-special/guddu-cake-og.png" />
<meta property="og:url" content="https://anuj1-web.github.io/Guddu-birthday-special/" />
<meta property="og:type" content="website" />

<!-- Twitter/X support -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://anuj1-web.github.io/Guddu-birthday-special/guddu-cake-og.png">
<meta name="twitter:title" content="Guddu Birthday Special 🎂">
<meta name="twitter:description" content="Tap to open a surprise birthday website for Guddu! 🥳">

</head>
<body>
  <!-- Skip link for accessibility -->
  <a href="#welcome" class="btn btn-ghost" style="position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden;">
    Skip to content
  </a>

  <header id="siteHeader">
    <div class="wrap nav">
      <a class="brand" href="#top" aria-label="home">
        <span class="logo" aria-hidden="true"></span>
        <span>Guddu's Day</span>
      </a>
      <div class="spacer"></div>

      <!-- Mobile toggle -->
      <button id="menuToggle" class="btn btn-ghost" aria-label="Toggle menu" aria-expanded="false" aria-controls="navLinks">☰</button>

      <!-- Links group -->
      <nav id="navLinks" class="nav-links" aria-label="Primary">
        <a class="btn btn-ghost" href="#welcome">Welcome</a>
        <a class="btn btn-ghost" href="#messages">Messages</a>
        <a class="btn btn-ghost" href="#gallery">Photos &amp; Videos</a>
        <a class="btn btn-ghost" href="#cards">Greeting Cards</a>
        <button id="themeBtn" class="btn btn-ghost" aria-label="Toggle theme">🌓</button>
        <button id="confettiBtn" class="btn btn-primary" aria-label="Confetti">🎉 Celebrate</button>
      </nav>
    </div>
  </header>

  <!-- Cake Cutting Banner -->
  <div id="cakeCutBanner" onclick="window.location.href='virtual-cake.html'" role="button" aria-label="Go to virtual cake page">
    🎂 <span>Let's cut the cake →</span>
  </div>

  <!-- HERO / WELCOME -->
  <main id="top" class="hero wrap" role="main" aria-labelledby="h1">
    <canvas id="sparkleCanvas" class="sparkles" aria-hidden="true"></canvas>
    <h1 id="h1"><span class="script">Happy Birthday,</span><br> dearest <span id="friendName">Guddu</span>! 🌸</h1>
    <p class="tag">Today is all about you. May your smile outshine the stars, your dreams soar high, and your heart stay forever happy. — With love, <span id="yourName">Your Friend</span> 💖</p>
    <div class="row mt-3">
      <a href="#messages" class="btn btn-primary">Read My Wishes ✨</a>
      <a href="#gallery" class="btn btn-ghost">Memories Gallery 📷</a>
      <button id="musicBtn" class="btn btn-ghost" aria-haspopup="dialog" aria-controls="musicModal">▶️ Play Birthday Tune</button>
    </div>
  </main>

  <!-- WELCOME SECTION -->
  <section id="welcome" class="section wrap" aria-labelledby="welcome-title">
    <h2 id="welcome-title" class="visually-hidden" style="position:absolute;left:-999px;">Welcome</h2>
    <div class="grid cards">
      <article class="card">
        <h3>To My Favorite Person, <span class="script" style="font-size:1.4em">Guddu</span> 🎀</h3>
        <p class="muted">On your special day, I built this little corner of the internet so you can feel just how cherished you are. Scroll down for surprises, memories, and love-filled messages, all for you. 💫</p>
        <div class="mt-3 row">
          <button class="btn btn-primary" onclick="burstHearts()">Send Hearts 💗</button>
          <button class="btn btn-ghost" onclick="typeOutMessage()">Reveal a Secret ✍️</button>
        </div>
      </article>

      <article class="card">
        <h3>Countdown to 28 Aug ⏳</h3>
        <p class="muted">Tick-tock to midnight magic (12:00 AM, 28 Aug). When it hits zero, surprises appear.</p>
        <div id="countdown" class="mt-3" aria-live="polite" style="font-weight:800; font-size:24px"></div>
      </article>

      <article class="card" style="cursor:pointer" onclick="window.location.href='personal-message.html'" aria-label="Open personal message card">
        <h3>Personalised Message 💌</h3>
        <p class="muted">A heartfelt note, just for you. Click to open your surprise message.</p>
        <div class="mt-3 btn btn-primary" style="display:inline-flex; align-items:center; gap:8px;">
          💖 Read Message
        </div>
      </article>
    </div>
  </section>

  <!-- MESSAGES -->
  <section id="messages" class="section wrap" aria-labelledby="messages-title">
    <h2 id="messages-title" class="script" style="font-size:40px; margin:0 0 12px">Wishes &amp; Words</h2>
    <div class="grid cards">
      <article class="gcard soft">
        <h4>For Your Heart</h4>
        <p>May your days be soft as sunrise and bright as your smile. You make ordinary moments feel like magic. Keep shining, Guddu! ✨</p>
      </article>
      <article class="gcard sunset">
        <h4>For Your Dreams</h4>
        <p>I believe in you—today, tomorrow, always. May every wish you whisper today start a beautiful new chapter. 🌅</p>
      </article>
      <article class="gcard ocean">
        <h4>For Your Laugh</h4>
        <p>Your laughter is my favorite sound. Remembering about you always gives me an inner smile. 🌊</p>
      </article>
      <article class="gcard glow">
        <h4>Promise</h4>
        <p>I’ll be right here—cheering for you, celebrating you, and reminding you how special you are. 💫</p>
      </article>
    </div>

    <div class="card mt-4">
      <h3>Mini Memory Timeline ⏱️</h3>
      <div class="timeline">
        <div class="titem"><span class="dot" aria-hidden="true"></span><div class="tcontent"><strong>First hello</strong> — The day the world got better for me. 🌟</div></div>
        <div class="titem"><span class="dot" aria-hidden="true"></span><div class="tcontent"><strong>First Face to Face meeting</strong> — The best day for me.💫</div></div>
        <div class="titem"><span class="dot" aria-hidden="true"></span><div class="tcontent"><strong>Today</strong> — A whole website just for you. 🎁</div></div>
      </div>
    </div>
  </section>

  <!-- GALLERY -->
  <section id="gallery" class="section wrap" aria-labelledby="gallery-title">
    <h2 id="gallery-title" class="script" style="font-size:40px; margin:0 0 12px">Photos &amp; Videos</h2>
    <p class="muted">Your Awesome pics and videos just to make you feel how much special you are. </p>
    <div class="gallery mt-3">
      <!-- IMAGES -->
      <figure class="media">
  <img src="https://www.dropbox.com/scl/fi/pio930eelwdhfjkkifsoy/Brown-Vintage-Scrapbook-Photo-Collage_20250815_180114_0000.png?rlkey=4secu6mx5kouzs91mn2dld967&st=jo3kkvbw&raw=1" 
       alt="Guddu smiling" 
       loading="lazy" 
       style="cursor: zoom-in; transition: transform 0.3s ease;">
  <figcaption class="cap">That sunshine smile ☀️</figcaption>
</figure>
     <figure class="media">
  <img src="https://www.dropbox.com/scl/fi/obircsfwbt1egkhqq4g0v/Black-Modern-Fashion-Girl-Photo-Collage_20250815_175302_0000.png?rlkey=s0ld18kt7iil858iyx6dditjs&st=urnz4ri3&raw=1" 
       alt="Birthday vibes" 
       loading="lazy" 
       style="cursor: zoom-in; transition: transform 0.3s ease;">
  <figcaption class="cap">Pre-birthday glow ✨</figcaption>
</figure>

      <figure class="media">
  <img src="https://www.dropbox.com/scl/fi/vh6fi2z253ubuak5lbg3k/Cream-and-Brown-Vintage-Aesthetic-Photo-Collage_20250815_175520_0000.png?rlkey=fp7qcsfc2elhwsfaw8glfgqcm&st=3qy7tttr&raw=1" 
       alt="Candid moment" 
       loading="lazy" 
       style="cursor: zoom-in; transition: transform 0.3s ease;">
  <figcaption class="cap">My favorite candid 📸</figcaption>
</figure>

      <!-- VIDEO -->
      <figure class="media">
  <video id="gudduVideo" 
         src="https://www.dropbox.com/scl/fi/tjogp3cj90bmpg7fdkmc9/video_20250815_234506_edit.mp4?rlkey=26kqoffdmojtkap3spth1eb94&raw=1" 
         controls 
         preload="metadata" 
         poster="assets/guddu-cover.jpg">
  </video>
  <figcaption class="cap">A little video memory 🎥</figcaption>
</figure>

    </div>
  </section>

  <!-- GREETING CARDS -->
  <section id="cards" class="section wrap" aria-labelledby="cards-title">
    <h2 id="cards-title" class="script" style="font-size:40px; margin:0 0 12px">Open Your Cards 💌</h2>
    <div class="grid cards">
      <article class="card">
        <h3>Classic Card</h3>
        <p class="muted">A simple, elegant wish you can screenshot or share.</p>
        <div class="center mt-3" style="padding:10px">
          <div id="cardClassic" style="width:100%; max-width:420px; aspect-ratio:4/5; border-radius:22px; background:linear-gradient(135deg, #ffe8f1, #e9ddff); display:flex; align-items:center; justify-content:center; text-align:center; padding:18px; position:relative; box-shadow:var(--shadow); overflow:hidden">
            <div style="position:absolute; inset:12px; border:2px dashed rgba(0,0,0,.1); border-radius:18px"></div>
            <div>
              <div style="font-family:'Great Vibes', cursive; font-size:42px; color:#ff3d77">Happy Birthday</div>
              <div style="font-weight:800; font-size:28px; letter-spacing:.3px; margin-top:6px" id="nameOnCard">Guddu</div>
              <p style="color:#6b6b6b; margin:10px 0 0">You are a blessing, today and always.You are The only girl whom i love with all my heart 💖</p>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <button class="btn btn-ghost" onclick="randomizePalette()">🎨 New Colors</button>
        </div>
      </article>

      <article class="card">
        <h3>Confetti Card</h3>
        <p class="muted">Tap to throw confetti and capture the moment.</p>
        <canvas id="cardConfetti" width="600" height="480" style="width:100%; max-width:600px; border-radius:18px; background:linear-gradient(135deg,#fff3d1,#ffe1f1);"></canvas>
        <div class="row mt-3">
          <button class="btn btn-primary" onclick="confettiBurstCanvas()">🎊 Confetti</button>
          <button class="btn btn-ghost" onclick="saveCanvas('cardConfetti','guddu-confetti.png')">⬇️ Download</button>
        </div>
      </article>

      <article class="card">
        <h3> With Love  💞</h3>
        <p class="muted">Write a custom note and lock it with a sparkle.</p>
        <textarea id="loveNote" rows="5" style="width:100%; border-radius:12px; border:1px solid rgba(0,0,0,.1); padding:12px; background:transparent; color:var(--text)" placeholder="Dear Guddu, ..."></textarea>
        <div class="row mt-3">
          <button class="btn btn-primary" onclick="saveNote()">💾 Save Note</button>
          <button class="btn btn-ghost" onclick="shareLink()">🔗 Share Link</button>
        </div>
        <small class="muted">(Saved only in your browser; to share publicly, host this page.)</small>
      </article>
    </div>
  </section>

  <footer>
    Made with 💖 by <span id="yourNameFoot">Your Friend Anuj</span> just for <strong>My dearest Guddu</strong>.
  </footer>

  <!-- Hidden audio (added to avoid JS errors) -->
  <audio id="song" preload="auto" hidden loop>
    <source src="assets/happy-birthday.mp3" type="audio/mpeg">
    <source src="assets/happy-birthday.ogg" type="audio/ogg">
  </audio>

  <!-- Music Modal (for autoplay prompt) -->
  <div id="musicModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="musicTitle">
    <div class="dialog">
      <h3 id="musicTitle">Start the birthday tune?</h3>
      <p class="muted">Tap play to add music to the celebration.</p>
      <div class="mt-3"><button class="btn btn-primary" onclick="playSongAndClose()">▶️ Play</button></div>
    </div>
  </div>

  <script>
    /* =========================
       Personalization
       ========================= */
    const FRIEND_NAME = "Guddu";     // her name
    const YOUR_NAME   = "Your Friend"; // your name shown on site

    document.querySelectorAll('#friendName, #nameOnCard').forEach(el => el.textContent = FRIEND_NAME);
    document.querySelectorAll('#yourName, #yourNameFoot').forEach(el => el.textContent = YOUR_NAME);

    /* =========================
       Theme toggle (saved)
       ========================= */
    const themeBtn = document.getElementById('themeBtn');
    const current = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    if(current==='dark') document.documentElement.setAttribute('data-theme','dark');
    themeBtn?.addEventListener('click',()=>{
      const d = document.documentElement;
      const dark = d.getAttribute('data-theme')==='dark';
      d.setAttribute('data-theme', dark? 'light':'dark');
      localStorage.setItem('theme', dark? 'light':'dark');
    });

    /* =========================
       Mobile menu toggle
       ========================= */
    const menuToggle = document.getElementById('menuToggle');
    const navLinks = document.getElementById('navLinks');
    menuToggle?.addEventListener('click', () => {
      const isOpen = navLinks.classList.toggle('open');
      menuToggle.setAttribute('aria-expanded', String(isOpen));
    });
    // Close menu after clicking a link (mobile)
    navLinks?.addEventListener('click', (e)=>{
      if(e.target.tagName === 'A' || e.target.tagName === 'BUTTON'){
        navLinks.classList.remove('open');
        menuToggle.setAttribute('aria-expanded','false');
      }
    });

    /* =========================
       Layout helpers (header & banner heights)
       ========================= */
    const header = document.getElementById('siteHeader');
    const cakeBanner = document.getElementById('cakeCutBanner');
    function updateLayoutVars(){
      const h = header?.getBoundingClientRect().height || 64;
      document.documentElement.style.setProperty('--header-h', h + 'px');
      const b = cakeBanner?.getBoundingClientRect().height || 0;
      document.documentElement.style.setProperty('--banner-h', b + 'px');
    }
    window.addEventListener('resize', updateLayoutVars);
    window.addEventListener('load', updateLayoutVars);
    updateLayoutVars();

    /* =========================
       Sparkle background in hero
       ========================= */
    const sp = document.getElementById('sparkleCanvas');
    const spx = sp.getContext('2d');
    let particles = [];
    function initSparkles(){
      sp.width = sp.offsetWidth; sp.height = sp.offsetHeight;
      particles = Array.from({length: 60}, () => ({
        x: Math.random()*sp.width, y: Math.random()*sp.height,
        r: Math.random()*2+0.5, s: Math.random()*0.8+0.2,
      }));
    }
    window.addEventListener('resize', initSparkles, {passive:true});
    initSparkles();
    (function loop(){
      spx.clearRect(0,0,sp.width,sp.height);
      particles.forEach(p=>{
        p.y += p.s; if(p.y>sp.height) p.y = -10;
        spx.beginPath(); spx.arc(p.x,p.y,p.r,0,Math.PI*2);
        spx.fillStyle = 'rgba(255,255,255,.7)'; spx.fill();
      });
      requestAnimationFrame(loop);
    })();

    /* =========================
       Floating hearts
       ========================= */
    function burstHearts(){
      for(let i=0;i<16;i++) setTimeout(()=>{
        const span = document.createElement('span');
        span.className='float-heart';
        span.textContent = ['💖','💗','💓','💕','💞'][Math.floor(Math.random()*5)];
        span.style.left = (Math.random()*80+10)+'vw';
        span.style.bottom = '12px';
        document.body.appendChild(span);
        setTimeout(()=>span.remove(), 3600);
      }, i*80);
    }

    /* =========================
       Countdown to next 28 Aug 12:00 AM
       ========================= */
    const countdownEl = document.getElementById('countdown');
    const cardsSection = document.getElementById('cards');
    function nextAug28Midnight(){
      const now = new Date();
      const year = (now.getMonth()>7 || (now.getMonth()===7 && now.getDate()>=28)) ? now.getFullYear()+1 : now.getFullYear();
      return new Date(year, 7, 28, 0, 0, 0, 0); // month index 7 = August
    }
    const targetTime = nextAug28Midnight();
    function pad(n){ return n<10 ? '0'+n : n; }
    let countdownTick = null;

    function renderCountdown(){
      const now = new Date();
      const diff = targetTime - now;
      if(diff <= 0){
        onBirthdayStart();
        return;
      }
      const days = Math.floor(diff / 86400000);
      const hours = Math.floor((diff % 86400000) / 3600000);
      const mins = Math.floor((diff % 3600000) / 60000);
      const secs = Math.floor((diff % 60000) / 1000);
      countdownEl.textContent = `${days}d ${pad(hours)}h ${pad(mins)}m ${pad(secs)}s`;
    }

    function onBirthdayStart(){
      if(countdownTick){ clearInterval(countdownTick); countdownTick=null; }
      countdownEl.style.transition = 'opacity .4s ease';
      countdownEl.style.opacity = '0';
      setTimeout(()=>{
        countdownEl.innerHTML = `<span class="headline-gold" style="font-size:26px">🎉 Happiest Birthday, ${FRIEND_NAME}! 🎉</span>`;
        countdownEl.style.opacity = '1';
        confetti(document.body, 220);
        burstHearts();
        setTimeout(()=> cardsSection.classList.remove('locked'), 450);
        musicModal.style.display='grid';
      }, 420);
    }
    countdownTick = setInterval(renderCountdown, 1000);
    renderCountdown();

    /* =========================
       Music controls
       ========================= */
    const musicBtn = document.getElementById('musicBtn');
    const song = document.getElementById('song');
    const musicModal = document.getElementById('musicModal');
    musicBtn?.addEventListener('click', ()=> musicModal.style.display='grid');
    function playSongAndClose(){
      musicModal.style.display='none';
      if(song){
        const playPromise = song.play();
        if(playPromise && typeof playPromise.then==='function'){
          playPromise.catch(()=>{/* ignore autoplay errors */});
        }
      }
    }

    /* =========================
       Confetti (page button)
       ========================= */
    const confettiBtn = document.getElementById('confettiBtn');
    confettiBtn?.addEventListener('click', ()=>{ confetti(document.body, 180); });

    /* =========================
       Typewriter secret message
       ========================= */
    function typeOutMessage(){
      const msg = `Dear ${FRIEND_NAME},\nYou are loved beyond words. Thank you for being you.`;
      let i=0; const box = document.createElement('div');
      box.className='card';
      box.style.position='fixed'; box.style.right='16px'; box.style.bottom='16px';
      box.style.maxWidth='340px'; box.style.zIndex='70';
      const p = document.createElement('pre'); p.style.margin='0'; p.style.whiteSpace='pre-wrap';
      box.appendChild(p); document.body.appendChild(box);
      const t = setInterval(()=>{ p.textContent = msg.slice(0, ++i); if(i>=msg.length) clearInterval(t); }, 22);
      setTimeout(()=> box.remove(), 9000);
    }

    /* =========================
       Greeting Card: DOM to PNG via SVG foreignObject
       ========================= */
    function downloadCard(id, filename){
      const node = document.getElementById(id);
      const { width, height } = node.getBoundingClientRect();
      const svg = new Blob([
        `<?xml version="1.0" standalone="no"?>\n`+
        `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">`+
        `<foreignObject width="100%" height="100%">`+
        new XMLSerializer().serializeToString(node) +
        `</foreignObject></svg>`
      ], {type:'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(svg);
      const img = new Image();
      img.onload = ()=>{
        const canvas = document.createElement('canvas'); canvas.width=width; canvas.height=height;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle='#fff'; ctx.fillRect(0,0,width,height); ctx.drawImage(img,0,0);
        URL.revokeObjectURL(url);
        canvas.toBlob(b=>{
          const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download=filename; a.click();
        }, 'image/png');
      };
      img.src = url;
    }
    function randomizePalette(){
      const el = document.getElementById('cardClassic');
      const palettes = [
        ['#ffe8f1','#e9ddff'], ['#d1f7ff','#ffe0e9'], ['#fff3d1','#ffdce7'], ['#e8ffe6','#e8f0ff']
      ];
      const p = palettes[Math.floor(Math.random()*palettes.length)];
      el.style.background = `linear-gradient(135deg, ${p[0]}, ${p[1]})`;
    }

    /* =========================
       Confetti canvas card
       ========================= */
    const cCanvas = document.getElementById('cardConfetti');
    function confettiBurstCanvas(){ confetti(cCanvas, 120); }
    function saveCanvas(id, filename){
      const c = document.getElementById(id);
      c.toBlob(b=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=filename; a.click(); }, 'image/png');
    }

    /* =========================
       Minimal confetti engine (canvas target)
       ========================= */
    function confetti(target, count=160){
      const rect = (target===document.body)
        ? {left:0, top:0, width:window.innerWidth, height:window.innerHeight}
        : target.getBoundingClientRect();
      const canvas = document.createElement('canvas');
      canvas.width = rect.width; canvas.height = rect.height;
      canvas.style.position='fixed';
      canvas.style.left=rect.left+'px'; canvas.style.top=rect.top+'px';
      canvas.style.pointerEvents='none'; canvas.style.zIndex=80;
      document.body.appendChild(canvas);
      const cx = canvas.getContext('2d');
      const pieces = Array.from({length:count}, ()=>({
        x: Math.random()*canvas.width,
        y: Math.random()*-canvas.height,
        w: Math.random()*8+4,
        h: Math.random()*12+6,
        r: Math.random()*Math.PI,
        s: Math.random()*2+1,
        c: `hsl(${Math.random()*360}, 90%, 60%)`
      }));
      let frame=0;
      (function animate(){
        cx.clearRect(0,0,canvas.width,canvas.height);
        pieces.forEach(p=>{
          p.y += p.s*2.2; p.x += Math.sin(frame/20 + p.r); p.r += 0.03;
          cx.save(); cx.translate(p.x,p.y); cx.rotate(p.r);
          cx.fillStyle=p.c; cx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
          cx.restore();
        });
        frame++;
        if(frame<260) requestAnimationFrame(animate); else canvas.remove();
      })();
    }

    /* =========================
       Save love note locally & share link
       ========================= */
    function saveNote(){
      localStorage.setItem('gudduLoveNote', document.getElementById('loveNote').value);
      alert('Saved on this device!');
    }
    document.getElementById('loveNote').value = localStorage.getItem('gudduLoveNote') || '';
    function shareLink(){
      const text = encodeURIComponent(document.getElementById('loveNote').value || `Happy Birthday, ${FRIEND_NAME}!`);
      const url = location.origin+location.pathname+`?wish=${text}`;
      navigator.clipboard.writeText(url);
      alert('Link copied!');
    }
    (function readWishFromURL(){
      const wish = new URLSearchParams(location.search).get('wish');
      if(wish){ document.getElementById('loveNote').value = decodeURIComponent(wish); }
    })();
 
  const bgSong = document.getElementById('bgSong');

  function tryPlay(unmute = false) {
    if (unmute) bgSong.muted = false;
    const playPromise = bgSong.play();
    if (playPromise !== undefined) {
      playPromise.catch(err => {
        console.warn("Autoplay blocked, waiting for user action...");
      });
    }
  }

  // Try muted autoplay on load
  window.addEventListener('load', () => {
    tryPlay(false);
    // Unmute after short delay
    setTimeout(() => { bgSong.muted = false; }, 300);
  });

  // Fallback: unmute & play when user clicks/taps anywhere
  document.addEventListener('click', () => {
    if (bgSong.paused) tryPlay(true);
    else if (bgSong.muted) bgSong.muted = false;
  }, { once: true });
</script>

<script>
// Zoom and fullscreen for all images inside .media
document.querySelectorAll('.media img').forEach(img => {
  img.addEventListener('click', () => {
    // Create overlay
    const overlay = document.createElement('div');
    overlay.style.position = 'fixed';
    overlay.style.inset = 0;
    overlay.style.background = 'rgba(0,0,0,0.85)';
    overlay.style.display = 'flex';
    overlay.style.alignItems = 'center';
    overlay.style.justifyContent = 'center';
    overlay.style.zIndex = '9999';
    overlay.style.cursor = 'zoom-out';
    overlay.style.animation = 'fadeInOverlay 0.25s ease';

    // Full-size image
    const fullImg = document.createElement('img');
    fullImg.src = img.src;
    fullImg.style.maxWidth = '90%';
    fullImg.style.maxHeight = '90%';
    fullImg.style.borderRadius = '12px';
    fullImg.style.boxShadow = '0 8px 30px rgba(0,0,0,0.5)';
    fullImg.style.transition = 'transform 0.3s ease';
    fullImg.style.transform = 'scale(0.8)';
    setTimeout(() => fullImg.style.transform = 'scale(1)', 10);

    overlay.appendChild(fullImg);

    // Remove overlay on click
    overlay.addEventListener('click', () => overlay.remove());

    document.body.appendChild(overlay);
  });
});

// Fade-in animation for overlay
const style = document.createElement('style');
style.textContent = `
@keyframes fadeInOverlay {
  from { opacity: 0; }
  to { opacity: 1; }
}`;
document.head.appendChild(style);
</script>
<script>
// Make sure to match the ID of your autoplay background audio element
const bgMusic = document.getElementById('bgMusic'); // Example: <audio id="bgMusic" ...>

document.querySelectorAll('video').forEach(video => {
  video.addEventListener('play', () => {
    if (bgMusic && !bgMusic.paused) {
      bgMusic.pause();
    }
  });
});
</script>
<!-- === Guddu 3D Portrait + Lightbox (drop-in) === -->
<script>
(function(){
  // ========= CONFIG =========
  // Use your Dropbox link; we'll auto-convert it to a raw, direct file URL
  const IMAGE_URL = "https://www.dropbox.com/scl/fi/az66uiikm7f203xvjbgv7/IMG-20250815-WA0009.jpg?rlkey=lihiqz3o3whtu37nk5pctht7l&st=3e27d3zp&dl=0";
  const TITLE_TEXT = "For Guddu, with love 💖";

  // Convert Dropbox link to direct (raw) form, works with dl=0/dl=1/&raw=1/&?dl=*
  function toRawDropbox(url){
    try{
      const u = new URL(url);
      if (u.hostname.includes("dropbox.com")) {
        // Use dl.dropboxusercontent.com for reliable direct file serving
        u.hostname = "dl.dropboxusercontent.com";
        // Remove any dl/raw params (the host change is enough)
        u.searchParams.delete("dl");
        u.searchParams.delete("raw");
        return u.toString();
      }
      return url;
    }catch(e){ return url; }
  }
  const RAW_IMG = toRawDropbox(IMAGE_URL);

  // ========= STYLES =========
  const css = `
  /* Section wrapper */
  #g3d-section { padding: 34px 18px; }
  #g3d-section .wrap-like { max-width: 1100px; margin: 0 auto; }

  /* Headline */
  #g3d-title { 
    font-family: "Great Vibes", cursive; 
    font-size: clamp(24px, 4vw, 36px); 
    text-align: center; 
    margin: 0 0 16px;
    color: var(--primary, #ff3d77);
    filter: drop-shadow(0 6px 16px rgba(255,61,119,.25));
  }

  /* Card stage */
  #g3d-stage {
    position: relative; 
    margin: 0 auto;
    width: min(92vw, 420px); 
    perspective: 1100px;
  }

  .g3d-card {
    position: relative;
    width: 100%; 
    aspect-ratio: 3 / 4;           /* nice portrait ratio */
    border-radius: 22px; 
    overflow: hidden;
    transform-style: preserve-3d;
    transition: transform 200ms ease, box-shadow 200ms ease, filter 200ms ease;
    box-shadow: 0 14px 40px rgba(0,0,0,.18);
    background: linear-gradient(135deg,#f9f0ff,#ffe9f1);
    cursor: pointer;
  }

  .g3d-img, .g3d-blur {
    position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;
    will-change: transform;
  }

  /* Soft background blur for depth */
  .g3d-blur {
    filter: blur(18px) saturate(120%);
    transform: scale(1.06);
    opacity: .55;
  }

  /* Main portrait */
  .g3d-img {
    transform: translateZ(45px) scale(1.02);
  }

  /* Shine layer that slides with pointer */
  .g3d-shine {
    position: absolute; inset: 0; pointer-events: none; mix-blend-mode: screen;
    background: radial-gradient(600px 360px at 50% 0%, rgba(255,255,255,.55), transparent 60%);
    opacity: .35;
    transform: translateZ(80px);
    transition: opacity .25s ease;
  }
  .g3d-card:active .g3d-shine { opacity: .55; }

  /* Caption badge */
  .g3d-caption {
    position: absolute; left: 50%; bottom: 12px; transform: translateX(-50%) translateZ(90px);
    background: rgba(0,0,0,.45); color: #fff;
    font: 600 14px/1.2 Poppins, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    padding: 8px 12px; border-radius: 12px; backdrop-filter: blur(8px);
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
  }

  /* Sparkles canvas */
  .g3d-sparkles { 
    position: absolute; inset: 0; pointer-events: none; 
    border-radius: 22px; 
    transform: translateZ(100px);
  }

  /* Skeleton while loading */
  .g3d-skel {
    position: absolute; inset: 0; border-radius: 22px;
    background: linear-gradient(90deg, rgba(255,255,255,.05), rgba(0,0,0,.06), rgba(255,255,255,.05));
    background-size: 240% 100%;
    animation: g3d-shimmer 1.4s linear infinite;
  }
  @keyframes g3d-shimmer { 
    0%{ background-position: 0% 0;} 
    100%{ background-position: 240% 0;}
  }

  /* Entrance animation */
  .g3d-in { animation: g3d-pop .6s cubic-bezier(.2,.8,.2,1) both; }
  @keyframes g3d-pop {
    0%{ opacity: 0; transform: translateY(14px) scale(.98); }
    100%{ opacity: 1; transform: translateY(0) scale(1); }
  }

  /* Lightbox */
  #g3d-lightbox {
    display:none; position: fixed; inset: 0; z-index: 9999;
    background: rgba(0,0,0,.92); 
    align-items: center; justify-content: center;
    touch-action: none; /* needed for custom pinch/pan */
  }
  #g3d-full {
    max-width: 94vw; max-height: 92vh; 
    border-radius: 14px; 
    box-shadow: 0 12px 40px rgba(255,255,255,.2);
    transform-origin: center center;
    transition: transform 120ms ease;
    will-change: transform;
    user-select: none;
    -webkit-user-drag: none;
    pointer-events: none; /* we pan the container */
  }
  #g3d-lightbox[data-open="1"] { display:flex; }
  #g3d-hint {
    position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%);
    color: rgba(255,255,255,.8); 
    font: 500 13px/1 Poppins, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    background: rgba(255,255,255,.08);
    padding: 8px 12px; border-radius: 10px;
    pointer-events: none;
  }

  /* Mobile friendliness */
  @media (max-width: 520px){
    .g3d-caption { font-size: 13px; padding: 7px 10px; }
  }
  `;
  const style = document.createElement('style');
  style.textContent = css;
  document.head.appendChild(style);

  // ========= MARKUP =========
  const section = document.createElement('section');
  section.id = "g3d-section";
  section.innerHTML = `
    <div class="wrap-like">
      <h2 id="g3d-title">${TITLE_TEXT}</h2>
      <div id="g3d-stage" class="g3d-in">
        <div class="g3d-card" id="g3d-card" role="button" aria-label="Open full-size portrait">
          <div class="g3d-skel" id="g3d-skel"></div>
          <img class="g3d-blur" id="g3d-blur" alt="Guddu portrait blur" />
          <img class="g3d-img" id="g3d-img" alt="Guddu portrait" />
          <div class="g3d-shine" id="g3d-shine"></div>
          <canvas class="g3d-sparkles" id="g3d-sparkles"></canvas>
          <div class="g3d-caption">Tap to view full size ✨</div>
        </div>
      </div>
    </div>
  `;
  // Append at very end so it never overlaps earlier content
  document.body.appendChild(section);

  // ========= IMAGE LOADING =========
  const imgMain = section.querySelector('#g3d-img');
  const imgBlur = section.querySelector('#g3d-blur');
  const skel    = section.querySelector('#g3d-skel');
  const card    = section.querySelector('#g3d-card');
  const shine   = section.querySelector('#g3d-shine');
  const spCanvas= section.querySelector('#g3d-sparkles');
  const spx     = spCanvas.getContext('2d');

  function fitSparkles(){
    const r = card.getBoundingClientRect();
    // account for DPR so sparkles stay sharp
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    spCanvas.width  = Math.floor(r.width * dpr);
    spCanvas.height = Math.floor(r.height * dpr);
    spCanvas.style.width  = r.width + 'px';
    spCanvas.style.height = r.height + 'px';
    spx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', fitSparkles, {passive:true});

  const preload = new Image();
  preload.onload = () => {
    imgMain.src = RAW_IMG;
    imgBlur.src = RAW_IMG;
    skel.style.display = "none";
    fitSparkles();
  };
  preload.onerror = () => {
    skel.style.display = "none";
    card.style.filter = "grayscale(1)";
  };
  preload.decoding = "async";
  preload.referrerPolicy = "no-referrer";
  preload.src = RAW_IMG;

  // ========= TILT EFFECT =========
  let tiltX = 0, tiltY = 0;
  let targetTiltX = 0, targetTiltY = 0;

  function applyTilt(){
    // Smooth follow
    tiltX += (targetTiltX - tiltX) * 0.12;
    tiltY += (targetTiltY - tiltY) * 0.12;
    card.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
    requestAnimationFrame(applyTilt);
  }
  applyTilt();

  // Pointer tilt
  card.addEventListener('pointermove', (e)=>{
    const r = card.getBoundingClientRect();
    const x = (e.clientX - r.left) / r.width;
    const y = (e.clientY - r.top) / r.height;
    targetTiltY = (x - 0.5) * 16;   // left/right
    targetTiltX = -(y - 0.5) * 10;  // up/down
    // Move shine origin
    shine.style.background = `radial-gradient(600px 360px at ${x*100}% ${y*100}%, rgba(255,255,255,.55), transparent 60%)`;
  });
  card.addEventListener('pointerleave', ()=>{
    targetTiltX = 0; targetTiltY = 0;
  });

  // Gentle idle bob if no movement
  let idleT = 0;
  setInterval(()=>{
    if (Math.abs(targetTiltX)<0.01 && Math.abs(targetTiltY)<0.01){
      idleT += 0.03;
      targetTiltX = Math.sin(idleT) * 2.2;
      targetTiltY = Math.cos(idleT*1.2) * 3.0;
    }
  }, 50);

  // Optional device orientation (no permission prompt)
  if ('DeviceOrientationEvent' in window){
    window.addEventListener('deviceorientation', (e)=>{
      if (e.beta==null || e.gamma==null) return;
      const maxX = 10, maxY = 14;
      targetTiltX = Math.max(-maxX, Math.min(maxX, (e.beta - 50) * 0.25));
      targetTiltY = Math.max(-maxY, Math.min(maxY, e.gamma * 0.6));
    }, {passive:true});
  }

  // ========= SPARKLES =========
  const pieces = [];
  function addSparkle(){
    const r = card.getBoundingClientRect();
    pieces.push({
      x: Math.random()*r.width,
      y: r.height + 10,
      r: Math.random()*2.2 + 1,
      s: Math.random()*0.8 + 0.5,
      a: Math.random()*Math.PI*2,
      h: Math.floor(Math.random()*360)
    });
  }
  function drawSparkles(){
    spx.clearRect(0,0,spCanvas.width, spCanvas.height);
    const r = card.getBoundingClientRect();
    for (let i=pieces.length-1; i>=0; i--){
      const p = pieces[i];
      p.y -= p.s * 1.6;
      p.x += Math.sin(p.a += 0.03) * 0.7;
      // soft glow circle
      spx.beginPath();
      spx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      spx.fillStyle = `hsla(${p.h}, 90%, 70%, .85)`;
      spx.fill();
      if (p.y < -8) pieces.splice(i,1);
    }
    // occasionally add
    if (Math.random() < 0.25) addSparkle();
    requestAnimationFrame(drawSparkles);
  }
  fitSparkles();
  drawSparkles();

  // ========= LIGHTBOX (tap to open full size) =========
  const overlay = document.createElement('div');
  overlay.id = 'g3d-lightbox';
  overlay.innerHTML = `<img id="g3d-full" alt="Guddu full size"><div id="g3d-hint">Pinch/drag to zoom • Tap outside to close</div>`;
  document.body.appendChild(overlay);

  const fullImg = overlay.querySelector('#g3d-full');

  // Open
  function openLightbox(){
    fullImg.src = RAW_IMG;
    overlay.dataset.open = "1";
    // reset view
    state.scale = 1; state.tx = 0; state.ty = 0;
    applyTransform();
  }
  // Close on background click / ESC
  overlay.addEventListener('click', (e)=>{
    if (e.target === overlay || e.target.id === 'g3d-hint'){
      overlay.dataset.open = "0";
      setTimeout(()=>{ overlay.style.display = "none"; fullImg.src = ""; }, 100);
    }
  });
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape' && overlay.dataset.open === "1"){
      overlay.click();
    }
  });
  // Show overlay
  card.addEventListener('click', ()=>{
    overlay.style.display = "flex";
    requestAnimationFrame(openLightbox);
  });

  // ========= ZOOM & PAN (desktop + mobile) =========
  const state = { scale: 1, tx: 0, ty: 0 };
  function applyTransform(){
    fullImg.style.transform = `translate(${state.tx}px, ${state.ty}px) scale(${state.scale})`;
  }
  // Wheel to zoom (desktop)
  overlay.addEventListener('wheel', (e)=>{
    e.preventDefault();
    const delta = -e.deltaY * 0.0015;
    const old = state.scale;
    state.scale = Math.min(6, Math.max(1, state.scale + delta));
    // zoom towards pointer
    const rect = fullImg.getBoundingClientRect();
    const cx = e.clientX - rect.left - rect.width/2;
    const cy = e.clientY - rect.top  - rect.height/2;
    state.tx -= (cx / old) * (state.scale - old);
    state.ty -= (cy / old) * (state.scale - old);
    applyTransform();
  }, {passive:false});

  // Drag to pan (desktop)
  let dragging = false, lx=0, ly=0;
  overlay.addEventListener('mousedown', (e)=>{
    // Only pan if image is zoomed
    if (state.scale <= 1) return;
    dragging = true; lx = e.clientX; ly = e.clientY;
    e.preventDefault();
  });
  overlay.addEventListener('mousemove', (e)=>{
    if (!dragging) return;
    state.tx += (e.clientX - lx);
    state.ty += (e.clientY - ly);
    lx = e.clientX; ly = e.clientY;
    applyTransform();
  });
  overlay.addEventListener('mouseup', ()=> dragging=false);
  overlay.addEventListener('mouseleave', ()=> dragging=false);

  // Touch pinch & pan (mobile)
  let t1 = null, t2 = null, lastDist = 0, lastMid = {x:0,y:0};
  overlay.addEventListener('touchstart', (e)=>{
    if (e.touches.length === 1){
      t1 = e.touches[0];
    } else if (e.touches.length === 2){
      t1 = e.touches[0]; t2 = e.touches[1];
      lastDist = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
      lastMid = { x:(t1.clientX + t2.clientX)/2, y:(t1.clientY + t2.clientY)/2 };
    }
  }, {passive:false});

  overlay.addEventListener('touchmove', (e)=>{
    if (e.touches.length === 1 && state.scale > 1){
      // pan
      const n1 = e.touches[0];
      state.tx += (n1.clientX - (t1?.clientX || n1.clientX));
      state.ty += (n1.clientY - (t1?.clientY || n1.clientY));
      t1 = n1;
      applyTransform();
      e.preventDefault();
    } else if (e.touches.length === 2){
      const n1 = e.touches[0], n2 = e.touches[1];
      const dist = Math.hypot(n2.clientX - n1.clientX, n2.clientY - n1.clientY);
      const mid  = { x:(n1.clientX + n2.clientX)/2, y:(n1.clientY + n2.clientY)/2 };
      const old = state.scale;
      const factor = dist / (lastDist || dist);
      state.scale = Math.min(6, Math.max(1, state.scale * factor));
      // zoom toward gesture midpoint
      const rect = fullImg.getBoundingClientRect();
      const cx = mid.x - rect.left - rect.width/2;
      const cy = mid.y - rect.top  - rect.height/2;
      state.tx -= (cx / old) * (state.scale - old);
      state.ty -= (cy / old) * (state.scale - old);
      lastDist = dist; lastMid = mid; t1 = n1; t2 = n2;
      applyTransform();
      e.preventDefault();
    }
  }, {passive:false});

  overlay.addEventListener('touchend', ()=>{
    t1 = null; t2 = null; lastDist = 0;
  });

})();
</script>
<!-- === /Guddu 3D Portrait === -->
<!-- Surprise Button -->
<div style="text-align: center; margin: 40px 0;">
  <a href="surprises.html" 
     style="display: inline-block; padding: 14px 28px; 
            background: linear-gradient(135deg, #ff69b4, #ff1493); 
            color: white; font-size: 20px; font-weight: bold; 
            border-radius: 12px; text-decoration: none; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
            transition: transform 0.2s, box-shadow 0.2s;">
    🎁 Open Your Surprises ✨
  </a>
</div>

<script>
  // Small hover effect
  const btn = document.querySelector('a[href="surprises.html"]');
  btn.addEventListener("mouseenter", () => {
    btn.style.transform = "scale(1.05)";
    btn.style.boxShadow = "0 6px 16px rgba(0,0,0,0.3)";
  });
  btn.addEventListener("mouseleave", () => {
    btn.style.transform = "scale(1)";
    btn.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
  });
</script>

</body>
</html>
