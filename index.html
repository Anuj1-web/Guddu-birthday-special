<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ff3d77" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0f0b12" media="(prefers-color-scheme: dark)">
  <title>Happy Birthday, Guddu! ğŸ‚ğŸ’–</title>
  <meta name="description" content="A lovingly crafted birthday surprise for Gudduâ€”messages, memories, photos, videos, and lots of sparkle."/>
  <meta property="og:title" content="Happy Birthday, Guddu!"/>
  <meta property="og:description" content="Open me, Guddu! A birthday site made with love."/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="assets/cover.jpg"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    /* =========================
       Core Theme Variables
       ========================= */
    :root{
      --bg: radial-gradient(1200px 800px at 10% 10%, #ffe6f2 0%, #fff 55%, #fff 100%);
      --text:#1a1a1a;
      --muted:#666;
      --primary:#ff3d77; /* pink */
      --accent:#7c4dff;  /* purple */
      --gold:#ffb800;
      --card:#ffffffeb;
      --border: rgba(0,0,0,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.07);
      --header-h: 64px;   /* updated at runtime */
      --banner-h: 0px;    /* updated at runtime */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    [data-theme="dark"]{
      --bg: radial-gradient(1200px 800px at 10% 10%, #2a1730 0%, #0f0b12 55%, #0f0b12 100%);
      --text:#f3f3f3;
      --muted:#b7b7b7;
      --card:#16131aeb;
      --border: rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.5);
      --primary:#ff5b8a;
      --accent:#9d7cff;
      --gold:#ffd45e;
    }

    /* Box sizing + base resets */
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; }
    body{
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:var(--bg);
      min-height:100vh;
      overflow-x:hidden;
      line-height:1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    img, video{ max-width:100%; height:auto; display:block; }
    a{ color:inherit; }
    button{ font-family:inherit; }
    :focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }

    /* =========================
       Header / Navigation
       ========================= */
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(180%) blur(8px);
      background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.25));
      border-bottom:1px solid var(--border);
    }
    [data-theme="dark"] header{
      background:linear-gradient(180deg, rgba(22,19,26,.65), rgba(22,19,26,.25));
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:14px 18px; }
    .nav{ display:flex; align-items:center; gap:14px; min-height:var(--header-h); }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text) }
    .brand .logo{
      width:36px; height:36px; border-radius:50%;
      background:conic-gradient(from 90deg, var(--primary), var(--accent));
      box-shadow:0 6px 16px rgba(124,77,255,.35);
      flex:0 0 auto;
    }
    .brand span{ font-weight:800; letter-spacing:.3px; }
    .spacer{ flex:1; }

    /* Buttons */
    .btn, button.btn{
      appearance:none; border:0; padding:10px 14px; border-radius:14px;
      cursor:pointer; font-weight:600; box-shadow:var(--shadow);
      transition:transform .12s ease, box-shadow .2s ease, background .2s ease;
      text-decoration:none; display:inline-flex; align-items:center; gap:8px;
      background:var(--card); color:var(--text);
    }
    .btn-primary{ background:linear-gradient(135deg, var(--primary), var(--accent)); color:#fff; }
    .btn-ghost{ background:var(--card); color:var(--text); }
    .btn:hover{ transform:translateY(-1px); }
    .btn:active{ transform:translateY(0); }

    /* Desktop nav links */
    .nav-links{ display:flex; align-items:center; gap:10px; }
    #menuToggle{
      display:none;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:8px 10px;
      line-height:1;
    }

    /* Mobile menu panel */
    @media (max-width: 860px){
      #menuToggle{ display:inline-flex; }
      .nav-links{
        position:fixed;
        left:0; right:0;
        top:calc(var(--header-h) + var(--banner-h));
        background:var(--card);
        border-bottom:1px solid var(--border);
        box-shadow:var(--shadow);
        padding:12px 18px;
        display:none;
        flex-direction:column;
        gap:10px;
        z-index:49;
      }
      .nav-links.open{ display:flex; }
      .nav-links a, .nav-links button{ width:100%; justify-content:center; }
    }

    /* =========================
       Hero
       ========================= */
    .hero{ position:relative; padding:80px 18px 40px; }
    .hero h1{
      font-size:clamp(36px, 5vw, 64px);
      line-height:1.05;
      margin:0 0 10px; font-weight:800;
    }
    .script{
      font-family:"Great Vibes", cursive;
      font-size:clamp(28px, 4vw, 48px);
      color:var(--primary);
      filter:drop-shadow(0 8px 18px rgba(255,61,119,.2));
      white-space:nowrap;
    }
    .tag{ color:var(--muted); font-weight:400; max-width:80ch; }

    .sparkles{ position:absolute; inset:0; pointer-events:none; }

    /* =========================
       Sections / Cards
       ========================= */
    section{ scroll-margin-top:calc(var(--header-h) + var(--banner-h) + 16px); }
    .section{ padding:32px 18px; }
    .grid{ display:grid; gap:18px; }
    .grid.cards{ grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); }
    .card{
      background:var(--card); border-radius:22px; padding:18px;
      box-shadow:var(--shadow); border:1px solid var(--border);
    }
    .card h3{ margin:6px 0 10px; }
    .muted{ color:var(--muted); }

    /* Gallery */
    .gallery{ display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px; }
    .media{ position:relative; border-radius:18px; overflow:hidden; box-shadow:var(--shadow); border:1px solid var(--border); }
    .media img, .media video{ width:100%; aspect-ratio: 4/3; object-fit:cover; }
    .media .cap{
      position:absolute; left:0; right:0; bottom:0; padding:10px 12px;
      background:linear-gradient(180deg, transparent, rgba(0,0,0,.55));
      color:#fff; font-size:14px;
    }

    /* Message gradient cards */
    .gcard{ position:relative; border-radius:22px; padding:20px; overflow:hidden; box-shadow:var(--shadow); color:#fff }
    .gcard h4{ margin:0 0 8px }
    .gcard p{ margin:0 }
    .gcard::after{ content:""; position:absolute; inset:0; border-radius:inherit; border:1px solid rgba(255,255,255,.15); pointer-events:none; }
    .gcard.glow::before{
      content:""; position:absolute; inset:-2px;
      background:conic-gradient(var(--primary), var(--accent), var(--gold), var(--primary));
      filter:blur(16px); opacity:.45;
    }
    .gcard.glow > *{ position:relative }
    .gcard.soft{ background:linear-gradient(135deg, #ff6fa1, #7c4dff) }
    .gcard.sunset{ background:linear-gradient(135deg, #ffb347, #ff3d77) }
    .gcard.ocean{ background:linear-gradient(135deg, #38bdf8, #7c4dff) }

    /* Timeline */
    .timeline{ position:relative; margin:10px 0 }
    .timeline::before{ content:""; position:absolute; left:12px; top:0; bottom:0; width:3px; background:linear-gradient(var(--accent), var(--primary)) }
    .titem{ display:grid; grid-template-columns:28px 1fr; gap:12px; align-items:start; margin:12px 0 }
    .dot{ width:24px; height:24px; border-radius:50%; background:linear-gradient(135deg, var(--primary), var(--accent)); box-shadow:0 6px 14px rgba(0,0,0,.2) }
    .tcontent{ background:var(--card); padding:12px 14px; border-radius:16px; box-shadow:var(--shadow); border:1px solid var(--border) }

    /* Footer */
    footer{ padding:60px 18px; text-align:center; color:var(--muted) }

    /* Floating hearts */
    .float-heart{ position:fixed; pointer-events:none; z-index:9999; font-size:18px; animation:floatUp 3.5s ease-in forwards }
    @keyframes floatUp{
      0%{opacity:0; transform:translateY(0) scale(.8)}
      10%{opacity:1}
      100%{opacity:0; transform:translateY(-160px) scale(1.6)}
    }

    /* Modal */
    .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.45); z-index:60; padding:20px }
    .modal .dialog{ background:var(--card); padding:20px; border-radius:18px; text-align:center; box-shadow:var(--shadow); border:1px solid var(--border) }

    /* Utility */
    .center{ display:flex; align-items:center; justify-content:center }
    .row{ display:flex; gap:10px; flex-wrap:wrap }
    .hidden{ display:none }
    .mt-2{ margin-top:8px } .mt-3{ margin-top:14px } .mt-4{ margin-top:22px }

    /* Reveal headline */
    .headline-gold{
      background:linear-gradient(90deg,#ffb800,#ff6fa1,#7c4dff,#ffb800);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      font-weight:800; letter-spacing:.5px; filter:drop-shadow(0 6px 16px rgba(124,77,255,.25));
      animation:shine 3.2s linear infinite;
    }
    @keyframes shine{
      0%{background-position:0% 50%}
      100%{background-position:200% 50%}
    }

    /* Lock cards until reveal */
    #cards{ transition:opacity .6s ease, transform .6s ease; }
    #cards.locked{ opacity:.0; transform:translateY(10px); pointer-events:none; }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .btn, .headline-gold{ animation:none }
      .float-heart{ animation:none }
    }

    /* ============ Mobile Tweaks ============ */
    @media (max-width: 768px) {
      .wrap { padding: 14px 14px; }
      .nav { gap:10px; }
      .btn, button.btn { font-size: 14px; padding: 10px 12px; border-radius:14px; }
      .hero { padding: 60px 14px 24px; text-align: center; }
      .script { white-space:normal; }
      .row { flex-direction: column; align-items: stretch; }
      .grid.cards { grid-template-columns: 1fr; }
      .gallery { grid-template-columns: 1fr; }
      .media img, .media video { aspect-ratio: 16/9; }
    }

    /* Extra small screens */
    @media (max-width: 420px){
      .brand span { font-size: 16px; }
      .brand .logo { width:30px; height:30px; }
      .hero { padding-top: 48px; }
      .btn, button.btn { padding: 9px 11px; }
    }

    /* Safe-area aware bottom spacing for sticky elements */
    .sticky-bottom-pad{ padding-bottom: max(16px, calc(16px + var(--safe-bottom))); }

    /* =========================
       Cake Cutting Banner
       ========================= */
    #cakeCutBanner{
      background: linear-gradient(90deg, #ff69b4, #ff99cc);
      color: white;
      font-family: 'Poppins', sans-serif;
      padding: 0.8rem 1.2rem;
      text-align: center;
      font-size: 1rem;
      font-weight: 700;
      position: fixed;
      top: calc(var(--header-h)); /* updated via JS to add banner offset when needed */
      left: 0;
      width: 100%;
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
      z-index: 49;
      cursor: pointer;
      display: flex; justify-content: center; align-items: center;
      gap:.5rem;
      border-bottom:1px solid rgba(255,255,255,.25);
    }
    #cakeCutBanner:hover { background: linear-gradient(90deg, #ff99cc, #ff69b4); }
    #cakeCutBanner span { margin-left: 2px; }

    /* =========================
       Extra Media Queries used by other pages (safe, won't break)
       ========================= */
    @media (max-width: 980px){
      body { overflow:auto !important; }
      .stage {
        grid-template-columns: 1fr !important;
        grid-template-rows: auto auto;
        gap: 12px !important;
        height: auto !important;
        padding: 0 12px !important;
      }
      img, canvas, video { max-width: 100% !important; height: auto !important; }
    }
    @media (max-width: 640px){
      .chat { height: auto !important; max-height: none !important; }
      .chatBody {
        padding: 10px !important;
        max-height: 48vh !important;
        overflow:auto !important;
      }
      .chatFoot {
        position: sticky !important;
        bottom: 0 !important;
        background: rgba(15,11,18,.75) !important;
        backdrop-filter: blur(6px) saturate(140%) !important;
        padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px)) !important;
      }
      .chatFoot input {
        padding: 12px !important;
        min-height: 44px !important;
        font-size: 16px !important;
      }
      #knife { width: clamp(110px, 34vw, 160px) !important; z-index: 12 !important; }
      .overlayNote { font-size: 12px !important; padding: 6px 10px !important; }
      .legend { font-size: 12px !important; padding: 8px 10px !important; }
    }
  </style>
</head>
<body>
  <!-- Skip link for accessibility -->
  <a href="#welcome" class="btn btn-ghost" style="position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden;">
    Skip to content
  </a>

  <header id="siteHeader">
    <div class="wrap nav">
      <a class="brand" href="#top" aria-label="home">
        <span class="logo" aria-hidden="true"></span>
        <span>Guddu's Day</span>
      </a>
      <div class="spacer"></div>

      <!-- Mobile toggle -->
      <button id="menuToggle" class="btn btn-ghost" aria-label="Toggle menu" aria-expanded="false" aria-controls="navLinks">â˜°</button>

      <!-- Links group -->
      <nav id="navLinks" class="nav-links" aria-label="Primary">
        <a class="btn btn-ghost" href="#welcome">Welcome</a>
        <a class="btn btn-ghost" href="#messages">Messages</a>
        <a class="btn btn-ghost" href="#gallery">Photos &amp; Videos</a>
        <a class="btn btn-ghost" href="#cards">Greeting Cards</a>
        <button id="themeBtn" class="btn btn-ghost" aria-label="Toggle theme">ğŸŒ“</button>
        <button id="confettiBtn" class="btn btn-primary" aria-label="Confetti">ğŸ‰ Celebrate</button>
      </nav>
    </div>
  </header>

  <!-- Cake Cutting Banner -->
  <div id="cakeCutBanner" onclick="window.location.href='virtual-cake.html'" role="button" aria-label="Go to virtual cake page">
    ğŸ‚ <span>Let's cut the cake â†’</span>
  </div>

  <!-- HERO / WELCOME -->
  <main id="top" class="hero wrap" role="main" aria-labelledby="h1">
    <canvas id="sparkleCanvas" class="sparkles" aria-hidden="true"></canvas>
    <h1 id="h1"><span class="script">Happy Birthday,</span><br> dearest <span id="friendName">Guddu</span>! ğŸŒ¸</h1>
    <p class="tag">Today is all about you. May your smile outshine the stars, your dreams soar high, and your heart stay forever happy. â€” With love, <span id="yourName">Your Friend</span> ğŸ’–</p>
    <div class="row mt-3">
      <a href="#messages" class="btn btn-primary">Read My Wishes âœ¨</a>
      <a href="#gallery" class="btn btn-ghost">Memories Gallery ğŸ“·</a>
      <button id="musicBtn" class="btn btn-ghost" aria-haspopup="dialog" aria-controls="musicModal">â–¶ï¸ Play Birthday Tune</button>
    </div>
  </main>

  <!-- WELCOME SECTION -->
  <section id="welcome" class="section wrap" aria-labelledby="welcome-title">
    <h2 id="welcome-title" class="visually-hidden" style="position:absolute;left:-999px;">Welcome</h2>
    <div class="grid cards">
      <article class="card">
        <h3>To My Favorite Person, <span class="script" style="font-size:1.4em">Guddu</span> ğŸ€</h3>
        <p class="muted">On your special day, I built this little corner of the internet so you can feel just how cherished you are. Scroll down for surprises, memories, and love-filled messages, all for you. ğŸ’«</p>
        <div class="mt-3 row">
          <button class="btn btn-primary" onclick="burstHearts()">Send Hearts ğŸ’—</button>
          <button class="btn btn-ghost" onclick="typeOutMessage()">Reveal a Secret âœï¸</button>
        </div>
      </article>

      <article class="card">
        <h3>Countdown to 28 Aug â³</h3>
        <p class="muted">Tick-tock to midnight magic (12:00 AM, 28 Aug). When it hits zero, surprises appear.</p>
        <div id="countdown" class="mt-3" aria-live="polite" style="font-weight:800; font-size:24px"></div>
      </article>

      <article class="card" style="cursor:pointer" onclick="window.location.href='personal-message.html'" aria-label="Open personal message card">
        <h3>Personalised Message ğŸ’Œ</h3>
        <p class="muted">A heartfelt note, just for you. Click to open your surprise message.</p>
        <div class="mt-3 btn btn-primary" style="display:inline-flex; align-items:center; gap:8px;">
          ğŸ’– Read Message
        </div>
      </article>
    </div>
  </section>

  <!-- MESSAGES -->
  <section id="messages" class="section wrap" aria-labelledby="messages-title">
    <h2 id="messages-title" class="script" style="font-size:40px; margin:0 0 12px">Wishes &amp; Words</h2>
    <div class="grid cards">
      <article class="gcard soft">
        <h4>For Your Heart</h4>
        <p>May your days be soft as sunrise and bright as your smile. You make ordinary moments feel like magic. Keep shining, Guddu! âœ¨</p>
      </article>
      <article class="gcard sunset">
        <h4>For Your Dreams</h4>
        <p>I believe in youâ€”today, tomorrow, always. May every wish you whisper today start a beautiful new chapter. ğŸŒ…</p>
      </article>
      <article class="gcard ocean">
        <h4>For Your Laugh</h4>
        <p>Your laughter is my favorite sound. Remembering about you always gives me an inner smile. ğŸŒŠ</p>
      </article>
      <article class="gcard glow">
        <h4>Promise</h4>
        <p>Iâ€™ll be right hereâ€”cheering for you, celebrating you, and reminding you how special you are. ğŸ’«</p>
      </article>
    </div>

    <div class="card mt-4">
      <h3>Mini Memory Timeline â±ï¸</h3>
      <div class="timeline">
        <div class="titem"><span class="dot" aria-hidden="true"></span><div class="tcontent"><strong>First hello</strong> â€” The day the world got better for me. ğŸŒŸ</div></div>
        <div class="titem"><span class="dot" aria-hidden="true"></span><div class="tcontent"><strong>First Face to Face meeting</strong> â€” The best day for me.ğŸ’«</div></div>
        <div class="titem"><span class="dot" aria-hidden="true"></span><div class="tcontent"><strong>Today</strong> â€” A whole website just for you. ğŸ</div></div>
      </div>
    </div>
  </section>

  <!-- GALLERY -->
  <section id="gallery" class="section wrap" aria-labelledby="gallery-title">
    <h2 id="gallery-title" class="script" style="font-size:40px; margin:0 0 12px">Photos &amp; Videos</h2>
    <p class="muted">Replace the media files in <code>assets/</code> and captions below with your real memories. (Examples shown.)</p>
    <div class="gallery mt-3">
      <!-- IMAGES -->
      <figure class="media">
  <img src="https://www.dropbox.com/scl/fi/pio930eelwdhfjkkifsoy/Brown-Vintage-Scrapbook-Photo-Collage_20250815_180114_0000.png?rlkey=4secu6mx5kouzs91mn2dld967&st=jo3kkvbw&raw=1" 
       alt="Guddu smiling" 
       loading="lazy" 
       style="cursor: zoom-in; transition: transform 0.3s ease;">
  <figcaption class="cap">That sunshine smile â˜€ï¸</figcaption>
</figure>
     <figure class="media">
  <img src="https://www.dropbox.com/scl/fi/obircsfwbt1egkhqq4g0v/Black-Modern-Fashion-Girl-Photo-Collage_20250815_175302_0000.png?rlkey=s0ld18kt7iil858iyx6dditjs&st=urnz4ri3&raw=1" 
       alt="Birthday vibes" 
       loading="lazy" 
       style="cursor: zoom-in; transition: transform 0.3s ease;">
  <figcaption class="cap">Pre-birthday glow âœ¨</figcaption>
</figure>

      <figure class="media">
  <img src="https://www.dropbox.com/scl/fi/vh6fi2z253ubuak5lbg3k/Cream-and-Brown-Vintage-Aesthetic-Photo-Collage_20250815_175520_0000.png?rlkey=fp7qcsfc2elhwsfaw8glfgqcm&st=3qy7tttr&raw=1" 
       alt="Candid moment" 
       loading="lazy" 
       style="cursor: zoom-in; transition: transform 0.3s ease;">
  <figcaption class="cap">My favorite candid ğŸ“¸</figcaption>
</figure>

      <!-- VIDEO -->
      <figure class="media">
  <video id="gudduVideo" 
         src="https://www.dropbox.com/scl/fi/tjogp3cj90bmpg7fdkmc9/video_20250815_234506_edit.mp4?rlkey=26kqoffdmojtkap3spth1eb94&raw=1" 
         controls 
         preload="metadata" 
         poster="assets/guddu-cover.jpg">
  </video>
  <figcaption class="cap">A little video memory ğŸ¥</figcaption>
</figure>

    </div>
  </section>

  <!-- GREETING CARDS -->
  <section id="cards" class="section wrap" aria-labelledby="cards-title">
    <h2 id="cards-title" class="script" style="font-size:40px; margin:0 0 12px">Open Your Cards ğŸ’Œ</h2>
    <div class="grid cards">
      <article class="card">
        <h3>Classic Card</h3>
        <p class="muted">A simple, elegant wish you can screenshot or share.</p>
        <div class="center mt-3" style="padding:10px">
          <div id="cardClassic" style="width:100%; max-width:420px; aspect-ratio:4/5; border-radius:22px; background:linear-gradient(135deg, #ffe8f1, #e9ddff); display:flex; align-items:center; justify-content:center; text-align:center; padding:18px; position:relative; box-shadow:var(--shadow); overflow:hidden">
            <div style="position:absolute; inset:12px; border:2px dashed rgba(0,0,0,.1); border-radius:18px"></div>
            <div>
              <div style="font-family:'Great Vibes', cursive; font-size:42px; color:#ff3d77">Happy Birthday</div>
              <div style="font-weight:800; font-size:28px; letter-spacing:.3px; margin-top:6px" id="nameOnCard">Guddu</div>
              <p style="color:#6b6b6b; margin:10px 0 0">You are a blessing, today and always.You are The only girl whom i love with all my heart ğŸ’–</p>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <button class="btn btn-ghost" onclick="randomizePalette()">ğŸ¨ New Colors</button>
        </div>
      </article>

      <article class="card">
        <h3>Confetti Card</h3>
        <p class="muted">Tap to throw confetti and capture the moment.</p>
        <canvas id="cardConfetti" width="600" height="480" style="width:100%; max-width:600px; border-radius:18px; background:linear-gradient(135deg,#fff3d1,#ffe1f1);"></canvas>
        <div class="row mt-3">
          <button class="btn btn-primary" onclick="confettiBurstCanvas()">ğŸŠ Confetti</button>
          <button class="btn btn-ghost" onclick="saveCanvas('cardConfetti','guddu-confetti.png')">â¬‡ï¸ Download</button>
        </div>
      </article>

      <article class="card">
        <h3> With Love  ğŸ’</h3>
        <p class="muted">Write a custom note and lock it with a sparkle.</p>
        <textarea id="loveNote" rows="5" style="width:100%; border-radius:12px; border:1px solid rgba(0,0,0,.1); padding:12px; background:transparent; color:var(--text)" placeholder="Dear Guddu, ..."></textarea>
        <div class="row mt-3">
          <button class="btn btn-primary" onclick="saveNote()">ğŸ’¾ Save Note</button>
          <button class="btn btn-ghost" onclick="shareLink()">ğŸ”— Share Link</button>
        </div>
        <small class="muted">(Saved only in your browser; to share publicly, host this page.)</small>
      </article>
    </div>
  </section>

  <footer>
    Made with ğŸ’– by <span id="yourNameFoot">Your Friend Anuj</span> just for <strong>My dearest Guddu</strong>.
  </footer>

  <!-- Hidden audio (added to avoid JS errors) -->
  <audio id="song" preload="auto" hidden loop>
    <source src="assets/happy-birthday.mp3" type="audio/mpeg">
    <source src="assets/happy-birthday.ogg" type="audio/ogg">
  </audio>

  <!-- Music Modal (for autoplay prompt) -->
  <div id="musicModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="musicTitle">
    <div class="dialog">
      <h3 id="musicTitle">Start the birthday tune?</h3>
      <p class="muted">Tap play to add music to the celebration.</p>
      <div class="mt-3"><button class="btn btn-primary" onclick="playSongAndClose()">â–¶ï¸ Play</button></div>
    </div>
  </div>

  <script>
    /* =========================
       Personalization
       ========================= */
    const FRIEND_NAME = "Guddu";     // her name
    const YOUR_NAME   = "Your Friend"; // your name shown on site

    document.querySelectorAll('#friendName, #nameOnCard').forEach(el => el.textContent = FRIEND_NAME);
    document.querySelectorAll('#yourName, #yourNameFoot').forEach(el => el.textContent = YOUR_NAME);

    /* =========================
       Theme toggle (saved)
       ========================= */
    const themeBtn = document.getElementById('themeBtn');
    const current = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    if(current==='dark') document.documentElement.setAttribute('data-theme','dark');
    themeBtn?.addEventListener('click',()=>{
      const d = document.documentElement;
      const dark = d.getAttribute('data-theme')==='dark';
      d.setAttribute('data-theme', dark? 'light':'dark');
      localStorage.setItem('theme', dark? 'light':'dark');
    });

    /* =========================
       Mobile menu toggle
       ========================= */
    const menuToggle = document.getElementById('menuToggle');
    const navLinks = document.getElementById('navLinks');
    menuToggle?.addEventListener('click', () => {
      const isOpen = navLinks.classList.toggle('open');
      menuToggle.setAttribute('aria-expanded', String(isOpen));
    });
    // Close menu after clicking a link (mobile)
    navLinks?.addEventListener('click', (e)=>{
      if(e.target.tagName === 'A' || e.target.tagName === 'BUTTON'){
        navLinks.classList.remove('open');
        menuToggle.setAttribute('aria-expanded','false');
      }
    });

    /* =========================
       Layout helpers (header & banner heights)
       ========================= */
    const header = document.getElementById('siteHeader');
    const cakeBanner = document.getElementById('cakeCutBanner');
    function updateLayoutVars(){
      const h = header?.getBoundingClientRect().height || 64;
      document.documentElement.style.setProperty('--header-h', h + 'px');
      const b = cakeBanner?.getBoundingClientRect().height || 0;
      document.documentElement.style.setProperty('--banner-h', b + 'px');
    }
    window.addEventListener('resize', updateLayoutVars);
    window.addEventListener('load', updateLayoutVars);
    updateLayoutVars();

    /* =========================
       Sparkle background in hero
       ========================= */
    const sp = document.getElementById('sparkleCanvas');
    const spx = sp.getContext('2d');
    let particles = [];
    function initSparkles(){
      sp.width = sp.offsetWidth; sp.height = sp.offsetHeight;
      particles = Array.from({length: 60}, () => ({
        x: Math.random()*sp.width, y: Math.random()*sp.height,
        r: Math.random()*2+0.5, s: Math.random()*0.8+0.2,
      }));
    }
    window.addEventListener('resize', initSparkles, {passive:true});
    initSparkles();
    (function loop(){
      spx.clearRect(0,0,sp.width,sp.height);
      particles.forEach(p=>{
        p.y += p.s; if(p.y>sp.height) p.y = -10;
        spx.beginPath(); spx.arc(p.x,p.y,p.r,0,Math.PI*2);
        spx.fillStyle = 'rgba(255,255,255,.7)'; spx.fill();
      });
      requestAnimationFrame(loop);
    })();

    /* =========================
       Floating hearts
       ========================= */
    function burstHearts(){
      for(let i=0;i<16;i++) setTimeout(()=>{
        const span = document.createElement('span');
        span.className='float-heart';
        span.textContent = ['ğŸ’–','ğŸ’—','ğŸ’“','ğŸ’•','ğŸ’'][Math.floor(Math.random()*5)];
        span.style.left = (Math.random()*80+10)+'vw';
        span.style.bottom = '12px';
        document.body.appendChild(span);
        setTimeout(()=>span.remove(), 3600);
      }, i*80);
    }

    /* =========================
       Countdown to next 28 Aug 12:00 AM
       ========================= */
    const countdownEl = document.getElementById('countdown');
    const cardsSection = document.getElementById('cards');
    function nextAug28Midnight(){
      const now = new Date();
      const year = (now.getMonth()>7 || (now.getMonth()===7 && now.getDate()>=28)) ? now.getFullYear()+1 : now.getFullYear();
      return new Date(year, 7, 28, 0, 0, 0, 0); // month index 7 = August
    }
    const targetTime = nextAug28Midnight();
    function pad(n){ return n<10 ? '0'+n : n; }
    let countdownTick = null;

    function renderCountdown(){
      const now = new Date();
      const diff = targetTime - now;
      if(diff <= 0){
        onBirthdayStart();
        return;
      }
      const days = Math.floor(diff / 86400000);
      const hours = Math.floor((diff % 86400000) / 3600000);
      const mins = Math.floor((diff % 3600000) / 60000);
      const secs = Math.floor((diff % 60000) / 1000);
      countdownEl.textContent = `${days}d ${pad(hours)}h ${pad(mins)}m ${pad(secs)}s`;
    }

    function onBirthdayStart(){
      if(countdownTick){ clearInterval(countdownTick); countdownTick=null; }
      countdownEl.style.transition = 'opacity .4s ease';
      countdownEl.style.opacity = '0';
      setTimeout(()=>{
        countdownEl.innerHTML = `<span class="headline-gold" style="font-size:26px">ğŸ‰ Happiest Birthday, ${FRIEND_NAME}! ğŸ‰</span>`;
        countdownEl.style.opacity = '1';
        confetti(document.body, 220);
        burstHearts();
        setTimeout(()=> cardsSection.classList.remove('locked'), 450);
        musicModal.style.display='grid';
      }, 420);
    }
    countdownTick = setInterval(renderCountdown, 1000);
    renderCountdown();

    /* =========================
       Music controls
       ========================= */
    const musicBtn = document.getElementById('musicBtn');
    const song = document.getElementById('song');
    const musicModal = document.getElementById('musicModal');
    musicBtn?.addEventListener('click', ()=> musicModal.style.display='grid');
    function playSongAndClose(){
      musicModal.style.display='none';
      if(song){
        const playPromise = song.play();
        if(playPromise && typeof playPromise.then==='function'){
          playPromise.catch(()=>{/* ignore autoplay errors */});
        }
      }
    }

    /* =========================
       Confetti (page button)
       ========================= */
    const confettiBtn = document.getElementById('confettiBtn');
    confettiBtn?.addEventListener('click', ()=>{ confetti(document.body, 180); });

    /* =========================
       Typewriter secret message
       ========================= */
    function typeOutMessage(){
      const msg = `Dear ${FRIEND_NAME},\nYou are loved beyond words. Thank you for being you.`;
      let i=0; const box = document.createElement('div');
      box.className='card';
      box.style.position='fixed'; box.style.right='16px'; box.style.bottom='16px';
      box.style.maxWidth='340px'; box.style.zIndex='70';
      const p = document.createElement('pre'); p.style.margin='0'; p.style.whiteSpace='pre-wrap';
      box.appendChild(p); document.body.appendChild(box);
      const t = setInterval(()=>{ p.textContent = msg.slice(0, ++i); if(i>=msg.length) clearInterval(t); }, 22);
      setTimeout(()=> box.remove(), 9000);
    }

    /* =========================
       Greeting Card: DOM to PNG via SVG foreignObject
       ========================= */
    function downloadCard(id, filename){
      const node = document.getElementById(id);
      const { width, height } = node.getBoundingClientRect();
      const svg = new Blob([
        `<?xml version="1.0" standalone="no"?>\n`+
        `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">`+
        `<foreignObject width="100%" height="100%">`+
        new XMLSerializer().serializeToString(node) +
        `</foreignObject></svg>`
      ], {type:'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(svg);
      const img = new Image();
      img.onload = ()=>{
        const canvas = document.createElement('canvas'); canvas.width=width; canvas.height=height;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle='#fff'; ctx.fillRect(0,0,width,height); ctx.drawImage(img,0,0);
        URL.revokeObjectURL(url);
        canvas.toBlob(b=>{
          const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download=filename; a.click();
        }, 'image/png');
      };
      img.src = url;
    }
    function randomizePalette(){
      const el = document.getElementById('cardClassic');
      const palettes = [
        ['#ffe8f1','#e9ddff'], ['#d1f7ff','#ffe0e9'], ['#fff3d1','#ffdce7'], ['#e8ffe6','#e8f0ff']
      ];
      const p = palettes[Math.floor(Math.random()*palettes.length)];
      el.style.background = `linear-gradient(135deg, ${p[0]}, ${p[1]})`;
    }

    /* =========================
       Confetti canvas card
       ========================= */
    const cCanvas = document.getElementById('cardConfetti');
    function confettiBurstCanvas(){ confetti(cCanvas, 120); }
    function saveCanvas(id, filename){
      const c = document.getElementById(id);
      c.toBlob(b=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=filename; a.click(); }, 'image/png');
    }

    /* =========================
       Minimal confetti engine (canvas target)
       ========================= */
    function confetti(target, count=160){
      const rect = (target===document.body)
        ? {left:0, top:0, width:window.innerWidth, height:window.innerHeight}
        : target.getBoundingClientRect();
      const canvas = document.createElement('canvas');
      canvas.width = rect.width; canvas.height = rect.height;
      canvas.style.position='fixed';
      canvas.style.left=rect.left+'px'; canvas.style.top=rect.top+'px';
      canvas.style.pointerEvents='none'; canvas.style.zIndex=80;
      document.body.appendChild(canvas);
      const cx = canvas.getContext('2d');
      const pieces = Array.from({length:count}, ()=>({
        x: Math.random()*canvas.width,
        y: Math.random()*-canvas.height,
        w: Math.random()*8+4,
        h: Math.random()*12+6,
        r: Math.random()*Math.PI,
        s: Math.random()*2+1,
        c: `hsl(${Math.random()*360}, 90%, 60%)`
      }));
      let frame=0;
      (function animate(){
        cx.clearRect(0,0,canvas.width,canvas.height);
        pieces.forEach(p=>{
          p.y += p.s*2.2; p.x += Math.sin(frame/20 + p.r); p.r += 0.03;
          cx.save(); cx.translate(p.x,p.y); cx.rotate(p.r);
          cx.fillStyle=p.c; cx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
          cx.restore();
        });
        frame++;
        if(frame<260) requestAnimationFrame(animate); else canvas.remove();
      })();
    }

    /* =========================
       Save love note locally & share link
       ========================= */
    function saveNote(){
      localStorage.setItem('gudduLoveNote', document.getElementById('loveNote').value);
      alert('Saved on this device!');
    }
    document.getElementById('loveNote').value = localStorage.getItem('gudduLoveNote') || '';
    function shareLink(){
      const text = encodeURIComponent(document.getElementById('loveNote').value || `Happy Birthday, ${FRIEND_NAME}!`);
      const url = location.origin+location.pathname+`?wish=${text}`;
      navigator.clipboard.writeText(url);
      alert('Link copied!');
    }
    (function readWishFromURL(){
      const wish = new URLSearchParams(location.search).get('wish');
      if(wish){ document.getElementById('loveNote').value = decodeURIComponent(wish); }
    })();
 
  const bgSong = document.getElementById('bgSong');

  function tryPlay(unmute = false) {
    if (unmute) bgSong.muted = false;
    const playPromise = bgSong.play();
    if (playPromise !== undefined) {
      playPromise.catch(err => {
        console.warn("Autoplay blocked, waiting for user action...");
      });
    }
  }

  // Try muted autoplay on load
  window.addEventListener('load', () => {
    tryPlay(false);
    // Unmute after short delay
    setTimeout(() => { bgSong.muted = false; }, 300);
  });

  // Fallback: unmute & play when user clicks/taps anywhere
  document.addEventListener('click', () => {
    if (bgSong.paused) tryPlay(true);
    else if (bgSong.muted) bgSong.muted = false;
  }, { once: true });
</script>

<script>
// Zoom and fullscreen for all images inside .media
document.querySelectorAll('.media img').forEach(img => {
  img.addEventListener('click', () => {
    // Create overlay
    const overlay = document.createElement('div');
    overlay.style.position = 'fixed';
    overlay.style.inset = 0;
    overlay.style.background = 'rgba(0,0,0,0.85)';
    overlay.style.display = 'flex';
    overlay.style.alignItems = 'center';
    overlay.style.justifyContent = 'center';
    overlay.style.zIndex = '9999';
    overlay.style.cursor = 'zoom-out';
    overlay.style.animation = 'fadeInOverlay 0.25s ease';

    // Full-size image
    const fullImg = document.createElement('img');
    fullImg.src = img.src;
    fullImg.style.maxWidth = '90%';
    fullImg.style.maxHeight = '90%';
    fullImg.style.borderRadius = '12px';
    fullImg.style.boxShadow = '0 8px 30px rgba(0,0,0,0.5)';
    fullImg.style.transition = 'transform 0.3s ease';
    fullImg.style.transform = 'scale(0.8)';
    setTimeout(() => fullImg.style.transform = 'scale(1)', 10);

    overlay.appendChild(fullImg);

    // Remove overlay on click
    overlay.addEventListener('click', () => overlay.remove());

    document.body.appendChild(overlay);
  });
});

// Fade-in animation for overlay
const style = document.createElement('style');
style.textContent = `
@keyframes fadeInOverlay {
  from { opacity: 0; }
  to { opacity: 1; }
}`;
document.head.appendChild(style);
</script>
<script>
// Make sure to match the ID of your autoplay background audio element
const bgMusic = document.getElementById('bgMusic'); // Example: <audio id="bgMusic" ...>

document.querySelectorAll('video').forEach(video => {
  video.addEventListener('play', () => {
    if (bgMusic && !bgMusic.paused) {
      bgMusic.pause();
    }
  });
});
</script>
<!-- ===== Guddu 3D Magic Portrait (drop-in) ===== -->
<style id="guddu3d-styles">
  #guddu3d-wrap{position:relative; margin:32px auto; max-width:1100px; padding:0 18px;}
  #guddu3d-card{
    position:relative; border-radius:24px; overflow:hidden;
    box-shadow:0 18px 50px rgba(124,77,255,.22);
    background:linear-gradient(135deg,#ffe6f2,#f1e9ff);
  }
  #guddu3d-stage{
    position:relative; width:100%; aspect-ratio:16/9; min-height:260px; height:auto;
  }
  #guddu3d, #guddu3d-sparkles{
    position:absolute; inset:0; width:100%; height:100%; display:block; border:0;
  }
  #guddu3d-loading{
    position:absolute; inset:0; display:grid; place-items:center;
    color:#6b6b6b; font-weight:600; backdrop-filter:saturate(160%) blur(2px);
  }
  #guddu3d-loading .bar{
    width:160px; height:8px; border-radius:999px; background:rgba(0,0,0,.06); overflow:hidden; margin-top:10px;
  }
  #guddu3d-loading .bar::after{
    content:""; display:block; height:100%; width:40%; border-radius:999px;
    background:linear-gradient(90deg,#ff6fa1,#7c4dff);
    animation:g3dload 1.2s infinite ease-in-out;
  }
  @keyframes g3dload{0%{transform:translateX(-60%)}100%{transform:translateX(260%)}}

  /* Fallback (no WebGL) */
  .g3d-tilt{
    position:relative; perspective:900px; transform-style:preserve-3d;
    border-radius:24px; overflow:hidden; box-shadow:0 18px 50px rgba(124,77,255,.22);
  }
  .g3d-tilt img{display:block; width:100%; height:auto; transform:translateZ(0); will-change:transform;}
  .g3d-tilt::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:radial-gradient(800px 400px at 10% 10%, rgba(255,255,255,.35), transparent 60%);
    mix-blend-mode:soft-light;
  }
  .g3d-title{
    position:absolute; left:16px; bottom:14px; z-index:2; padding:8px 12px;
    border-radius:14px; font-weight:800; letter-spacing:.4px; color:white;
    background:linear-gradient(135deg, rgba(255,61,119,.9), rgba(124,77,255,.9));
    box-shadow:0 10px 24px rgba(0,0,0,.18);
  }

  /* Reduce motion friendly */
  @media (prefers-reduced-motion: reduce){
    #guddu3d-sparkles{display:none}
  }
</style>

<script>
(function(){
  // ---- CONFIG: your photo (Dropbox "raw") ----
 const PHOTO_URL = "https://www.dropbox.com/scl/fi/az66uiikm7f203xvjbgv7/IMG-20250815-WA0009.jpg?rlkey=lihiqz3o3whtu37nk5pctht7l&st=3e27d3zp&raw=1";

  // ---- Insert section near the hero (or at top of body) ----
  const wrap = document.createElement('section');
  wrap.id = 'magic3D';
  wrap.className = 'section'; // matches your siteâ€™s spacing
  wrap.innerHTML = `
    <div id="guddu3d-wrap">
      <div id="guddu3d-card">
        <div id="guddu3d-stage">
          <canvas id="guddu3d" aria-label="3D portrait of Guddu"></canvas>
          <canvas id="guddu3d-sparkles" aria-hidden="true"></canvas>
          <div id="guddu3d-loading" role="status" aria-live="polite">
            <div style="text-align:center">
              <div>Crafting 3D magic for Gudduâ€¦ âœ¨</div>
              <div class="bar"></div>
            </div>
          </div>
          <div class="g3d-title">For Guddu, with love ğŸ’–</div>
        </div>
      </div>
    </div>
  `;
  const ref = document.getElementById('gallery') || document.getElementById('welcome') || document.body.firstElementChild;
  (ref && ref.parentNode) ? ref.parentNode.insertBefore(wrap, ref) : document.body.insertBefore(wrap, document.body.firstChild);

  // ---- Sparkles overlay ----
  const sparkles = (() => {
    const c = document.getElementById('guddu3d-sparkles');
    const x = c.getContext('2d');
    let pts = [], raf = 0;
    function resize(){
      const rect = c.parentElement.getBoundingClientRect();
      c.width = Math.floor(rect.width * devicePixelRatio);
      c.height = Math.floor(rect.height * devicePixelRatio);
      c.style.width = rect.width + 'px'; c.style.height = rect.height + 'px';
      pts = Array.from({length: 60}, () => ({
        x: Math.random()*c.width, y: Math.random()*c.height,
        r: Math.random()*2*devicePixelRatio + .8,
        s: Math.random()*0.8 + 0.2, a: Math.random()*Math.PI*2
      }));
    }
    function draw(){
      x.clearRect(0,0,c.width,c.height);
      pts.forEach(p=>{
        p.y += p.s*1.2; if(p.y>c.height+20) p.y = -20;
        p.x += Math.sin(p.a += 0.02); // gentle sway
        x.beginPath(); x.arc(p.x,p.y,p.r,0,6.2831);
        x.fillStyle = 'rgba(255,255,255,.8)'; x.fill();
      });
      raf = requestAnimationFrame(draw);
    }
    resize(); addEventListener('resize', resize, {passive:true});
    draw();
    return {stop:()=>cancelAnimationFrame(raf)};
  })();

  // ---- WebGL 3D Parallax (with graceful fallback) ----
  const canvas = document.getElementById('guddu3d');
  const loader = document.getElementById('guddu3d-loading');
  const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;

  let gl;
  try {
    gl = canvas.getContext('webgl', {alpha:true, antialias:true, powerPreference:'high-performance'});
  } catch(e){ gl = null; }

  if(!gl){
    fallbackTilt();
    return;
  }

  const vertexSrc = `
    attribute vec2 position;
    varying vec2 vUv;
    void main(){
      vUv = position*0.5 + 0.5;
      gl_Position = vec4(position, 0.0, 1.0);
    }
  `;
  const fragmentSrc = `
    precision mediump float;
    uniform sampler2D uTex;
    uniform vec2 uMouse;   // -1..1
    uniform float uTime;
    uniform float uStrength;
    varying vec2 vUv;

    // Luma
    float luma(vec3 c){ return dot(c, vec3(0.299,0.587,0.114)); }

    void main(){
      // Fake depth from brightness (centered around 0.5)
      vec3 base = texture2D(uTex, vUv).rgb;
      float depth = luma(base);
      float d = depth - 0.5;

      // Parallax (mouse/gyro) + subtle breathing wave
      vec2 dir = uMouse * 0.5;
      float wave = sin((vUv.x + vUv.y + uTime*0.15)*6.2831)*0.015;
      vec2 uv = vUv + (dir * uStrength * d) + wave * vec2(dir.y, -dir.x);

      // Sample image with gentle sharpening
      vec3 col = texture2D(uTex, uv).rgb;
      vec3 col1 = texture2D(uTex, uv + vec2(0.001,0.0)).rgb;
      vec3 col2 = texture2D(uTex, uv + vec2(0.0,0.001)).rgb;
      col = mix(col, (col*1.1 - (col1+col2)*0.05), 0.25);

      // Sheen/glow that reacts to "depth" and pointer direction
      float highlight = pow(max(0.0, dot(normalize(vec3(-dir,1.0)), vec3(0.0,0.0,1.0))) * (0.5+abs(d)), 6.0);
      vec3 glow = highlight * vec3(1.0,0.85,1.0);

      // Soft vignette to keep it dreamy
      float vign = smoothstep(0.95, 0.5, distance(vUv, vec2(0.5)));
      vec3 final = col * vign + glow;

      gl_FragColor = vec4(final, 1.0);
    }
  `;

  // Build program
  function compile(type, src){
    const s = gl.createShader(type); gl.shaderSource(s, src); gl.compileShader(s);
    if(!gl.getShaderParameter(s, gl.COMPILE_STATUS)) throw new Error(gl.getShaderInfoLog(s));
    return s;
  }
  function program(vs, fs){
    const p = gl.createProgram(); gl.attachShader(p, vs); gl.attachShader(p, fs); gl.linkProgram(p);
    if(!gl.getProgramParameter(p, gl.LINK_STATUS)) throw new Error(gl.getProgramInfoLog(p));
    return p;
  }

  let prog, uTex, uMouse, uTime, uStrength, posBuf, tex, mouse=[0,0], start=performance.now();
  try{
    prog = program(compile(gl.VERTEX_SHADER, vertexSrc), compile(gl.FRAGMENT_SHADER, fragmentSrc));
  }catch(err){
    console.warn('WebGL shader error:', err); fallbackTilt(); return;
  }
  gl.useProgram(prog);

  // Fullscreen triangle/quad
  const posLoc = gl.getAttribLocation(prog, 'position');
  posBuf = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, posBuf);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
    -1,-1,  1,-1,  -1, 1,
     -1, 1,  1,-1,   1, 1
  ]), gl.STATIC_DRAW);
  gl.enableVertexAttribArray(posLoc);
  gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

  uTex = gl.getUniformLocation(prog, 'uTex');
  uMouse = gl.getUniformLocation(prog, 'uMouse');
  uTime = gl.getUniformLocation(prog, 'uTime');
  uStrength = gl.getUniformLocation(prog, 'uStrength');

  // Load image as texture
  function loadTexture(url){
    return new Promise((resolve, reject)=>{
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = ()=> {
        const t = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, t);
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        resolve({t, w: img.naturalWidth, h: img.naturalHeight});
      };
      img.onerror = reject;
      img.src = url;
    });
  }

  // Resize canvas to container
  function resize(){
    const rect = canvas.parentElement.getBoundingClientRect();
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    canvas.width = Math.max(2, Math.floor(rect.width * dpr));
    canvas.height = Math.max(2, Math.floor(rect.height * dpr));
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';
    gl.viewport(0,0,canvas.width,canvas.height);
  }
  addEventListener('resize', resize, {passive:true});
  resize();

  // Pointer/gyro controls
  const target = canvas.parentElement;
  let lastMove = Date.now();
  function setMouse(nx, ny){
    mouse[0] = nx; mouse[1] = ny; lastMove = Date.now();
  }
  target.addEventListener('mousemove', (e)=>{
    const r = target.getBoundingClientRect();
    const x = (e.clientX - r.left)/r.width;
    const y = (e.clientY - r.top)/r.height;
    setMouse((x-0.5)*2, (0.5-y)*2);
  }, {passive:true});
  target.addEventListener('mouseleave', ()=> setMouse(0,0), {passive:true});

  // Touch
  target.addEventListener('touchmove', (e)=>{
    const t = e.touches[0]; if(!t) return;
    const r = target.getBoundingClientRect();
    const x = (t.clientX - r.left)/r.width;
    const y = (t.clientY - r.top)/r.height;
    setMouse((x-0.5)*2, (0.5-y)*2);
  }, {passive:true});
  target.addEventListener('touchend', ()=> setMouse(0,0), {passive:true});

  // Gyro (iOS needs permission)
  (function enableGyro(){
    if(typeof DeviceOrientationEvent === 'undefined') return;
    const ask = () => {
      if(DeviceOrientationEvent.requestPermission){
        DeviceOrientationEvent.requestPermission().then(state=>{
          if(state === 'granted'){
            window.addEventListener('deviceorientation', onOrient, true);
          }
        }).catch(()=>{});
      } else {
        window.addEventListener('deviceorientation', onOrient, true);
      }
    };
    // try auto; some browsers ignore without user gesture, no harm
    setTimeout(ask, 600);
    function onOrient(e){
      const beta = (e.beta||0)/90;   // front/back
      const gamma = (e.gamma||0)/45; // left/right
      setMouse(gamma, beta);
    }
  })();

  // Animate
  let strengthBase = 0.18;
  if(prefersReduced) strengthBase = 0.08;

  function draw(){
    const t = (performance.now()-start)/1000;
    // idle sway if no recent movement
    const idle = (Date.now()-lastMove) > 2000;
    const idleX = Math.sin(t*0.5)*0.2, idleY = Math.cos(t*0.6)*0.2;
    const mx = idle ? idleX : mouse[0];
    const my = idle ? idleY : mouse[1];

    gl.clearColor(0,0,0,0); gl.clear(gl.COLOR_BUFFER_BIT);

    gl.useProgram(prog);
    gl.uniform1i(uTex, 0);
    gl.uniform2f(uMouse, mx, my);
    gl.uniform1f(uTime, t);
    gl.uniform1f(uStrength, strengthBase);

    gl.drawArrays(gl.TRIANGLES, 0, 6);
    requestAnimationFrame(draw);
  }

  loadTexture(PHOTO_URL).then(({t})=>{
    tex = t; gl.activeTexture(gl.TEXTURE0); gl.bindTexture(gl.TEXTURE_2D, tex);
    loader.style.display = 'none';
    draw();
  }).catch(err=>{
    console.warn('Texture load failed, using fallback.', err);
    fallbackTilt();
  });

  // ---- Fallback: CSS tilt card ----
  function fallbackTilt(){
    try { sparkles.stop && sparkles.stop(); } catch(_){}
    const stage = document.getElementById('guddu3d-stage');
    stage.innerHTML = `
      <div class="g3d-tilt" id="g3d-fallback">
        <img src="${PHOTO_URL}" alt="Guddu portrait">
        <div class="g3d-title">For Guddu, with love ğŸ’–</div>
      </div>
    `;
    const card = document.getElementById('g3d-fallback');
    let rx=0, ry=0, raf=0;
    function onMove(e){
      const r = card.getBoundingClientRect();
      const cx = (('touches' in e ? e.touches[0].clientX : e.clientX) - r.left)/r.width;
      const cy = (('touches' in e ? e.touches[0].clientY : e.clientY) - r.top)/r.height;
      rx = ((cy-0.5)*-1)*14; ry = ((cx-0.5))*14;
      if(!raf) raf = requestAnimationFrame(()=>{
        card.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg)`;
        raf=0;
      });
    }
    card.addEventListener('mousemove', onMove, {passive:true});
    card.addEventListener('mouseleave', ()=>{ card.style.transform='perspective(900px) rotateX(0) rotateY(0)'; }, {passive:true});
    card.addEventListener('touchmove', onMove, {passive:true});
    card.addEventListener('touchend', ()=>{ card.style.transform='perspective(900px) rotateX(0) rotateY(0)'; }, {passive:true});
  }
})();
</script>
<!-- ===== /Guddu 3D Magic Portrait ===== -->

</body>
</html>
