<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Birthday City â€“ Textures Embedded</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#0f1218}
  #overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0009}
  #btn{font:600 15px system-ui;padding:12px 16px;border:0;border-radius:12px;cursor:pointer}
  #hud{position:fixed;left:50%;top:10px;transform:translateX(-50%);
       color:#fff;background:#0008;border-radius:10px;padding:6px 10px;font:600 12px system-ui}
  #msg{position:fixed;left:50%;top:50px;transform:translateX(-50%);
       color:#fff;background:#000b;border-radius:10px;padding:10px 14px;font:700 14px system-ui;display:none}
  #cross{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);color:#fff;opacity:.6;font:700 22px monospace}
</style>
</head>
<body>
<div id="overlay"><button id="btn">Click to enter â€¢ Mouse-look + WASD â€¢ Space jump</button></div>
<div id="hud">Controls: click to lock â€¢ WASD move â€¢ Space jump â€¢ Aim crosshair + click to collect gifts</div>
<div id="msg"></div>
<div id="cross">+</div>

<script src="three.min.js"></script>

<!-- PointerLockControls -->
<script>
THREE.PointerLockControls=function(camera,dom){
  const S=this; this.domElement=dom||document.body; this.isLocked=false;
  const E={change:{type:'change'},lock:{type:'lock'},unlock:{type:'unlock'}};
  const euler=new THREE.Euler(0,0,0,'YXZ'), PI_2=Math.PI/2;
  function onMove(ev){
    if(!S.isLocked) return;
    const mx=ev.movementX||0, my=ev.movementY||0;
    euler.setFromQuaternion(camera.quaternion);
    euler.y-=mx*0.002; euler.x-=my*0.002; euler.x=Math.max(-PI_2,Math.min(PI_2,euler.x));
    camera.quaternion.setFromEuler(euler); S.dispatchEvent(E.change);
  }
  function onPLC(){ S.isLocked=(document.pointerLockElement===S.domElement); S.dispatchEvent(S.isLocked?E.lock:E.unlock); }
  this.lock=()=>this.domElement.requestPointerLock();
  this.unlock=()=>document.exitPointerLock();
  this.connect=()=>{
    document.addEventListener('mousemove',onMove);
    document.addEventListener('pointerlockchange',onPLC);
  };
  this.disconnect=()=>{
    document.removeEventListener('mousemove',onMove);
    document.removeEventListener('pointerlockchange',onPLC);
  };
  this.dispose=()=>this.disconnect(); this.connect();
};
THREE.PointerLockControls.prototype=Object.create(THREE.EventDispatcher.prototype);
THREE.PointerLockControls.prototype.constructor=THREE.PointerLockControls;
</script>

<script>
let scene, camera, renderer, controls, raycaster, gifts=[];
let moveF=false, moveB=false, moveL=false, moveR=false, canJump=false, day=true;
const velocity=new THREE.Vector3(), dir=new THREE.Vector3();
const GRAV=30;
const clock=new THREE.Clock();

init(); animate();

function init(){
  scene=new THREE.Scene(); setSky(true);

  camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,1000);
  camera.position.set(0,1.1,6);

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setPixelRatio(devicePixelRatio);
  renderer.setSize(innerWidth,innerHeight);
  renderer.shadowMap.enabled=true;
  document.body.appendChild(renderer.domElement);

  raycaster=new THREE.Raycaster();

  // ground
  const ground=new THREE.Mesh(new THREE.PlaneGeometry(200,200),
    new THREE.MeshStandardMaterial({color:0x3b3f46, roughness:.95}));
  ground.rotation.x=-Math.PI/2; ground.receiveShadow=true; scene.add(ground);

  // lights
  const hemi=new THREE.HemisphereLight(0xbfd9ff,0x23262b,.9); scene.add(hemi);
  const sun=new THREE.DirectionalLight(0xffffff,.9); sun.position.set(40,80,20);
  sun.castShadow=true; sun.name='SUN'; scene.add(sun);

  // building with embedded glass texture (base64 tiny image)
  const glassTex=new THREE.TextureLoader().load(
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIklEQVQoU2NkYGD4z0AEMFGKmSgFjKJqghJqRphIAAaTBACQpBoFYAAAAABJRU5ErkJggg=="
  );
  glassTex.wrapS=glassTex.wrapT=THREE.RepeatWrapping;
  glassTex.repeat.set(8,16);
  glassTex.anisotropy=renderer.capabilities.getMaxAnisotropy();

  const building=new THREE.Mesh(new THREE.BoxGeometry(12,25,12),
    new THREE.MeshStandardMaterial({map:glassTex, roughness:.6, metalness:.2}));
  building.position.set(0,12.5,-18); building.castShadow=true; scene.add(building);

  // hoarding (white placeholder with text)
  const canvas=document.createElement("canvas"); canvas.width=512; canvas.height=256;
  const ctx=canvas.getContext("2d"); ctx.fillStyle="#222"; ctx.fillRect(0,0,512,256);
  ctx.fillStyle="#fff"; ctx.font="bold 40px sans-serif"; ctx.fillText("Happy Birthday Guddu ðŸŽ‚",40,140);
  const tex=new THREE.CanvasTexture(canvas);
  const board=new THREE.Mesh(new THREE.PlaneGeometry(10,5), new THREE.MeshBasicMaterial({map:tex}));
  board.position.set(0,15,-12); board.lookAt(new THREE.Vector3(0,15,30)); scene.add(board);

  // gift
  const gift=createGift(new THREE.Vector3(3,1,0),"Happy Birthday Guddu! ðŸŽâœ¨");
  gifts.push(gift);

  // controls
  controls=new THREE.PointerLockControls(camera,document.body);
  document.getElementById('btn').onclick=()=>{ controls.lock(); document.getElementById('overlay').style.display='none'; };
  controls.addEventListener('unlock',()=>{ document.getElementById('overlay').style.display='flex'; });

  addEventListener('keydown',onKeyDown);
  addEventListener('keyup',onKeyUp);
  addEventListener('click',onMouseClick);
  addEventListener('resize',()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight); });
}

function animate(){
  requestAnimationFrame(animate);
  const dt=Math.min(0.05,clock.getDelta());

  dir.set(0,0,0);
  if(moveF) dir.z-=1; if(moveB) dir.z+=1; if(moveL) dir.x-=1; if(moveR) dir.x+=1;
  if(dir.lengthSq()>0) dir.normalize();

  const speed=10*dt;
  const yaw=new THREE.Quaternion().setFromEuler(new THREE.Euler(0,camera.rotation.y,0));
  const step=dir.clone().applyQuaternion(yaw).multiplyScalar(speed);
  camera.position.add(new THREE.Vector3(step.x,0,step.z));

  velocity.y -= GRAV*dt;
  camera.position.y += velocity.y*dt;
  if(camera.position.y<1.1){ camera.position.y=1.1; velocity.y=0; canJump=true; }

  renderer.render(scene,camera);
}

/* === INTERACTIONS === */
function onMouseClick(){
  raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
  const intersects=raycaster.intersectObjects(gifts.map(g=>g.mesh),false);
  if(intersects.length>0){
    const gift=gifts.find(g=>g.mesh===intersects[0].object);
    if(gift && !gift.collected){
      gift.collected=true; scene.remove(gift.mesh);
      sparkle(gift.mesh.position); chime(); showMsg(gift.msg);
    }
  }
}
function onKeyDown(e){
  switch(e.code){
    case'KeyW':case'ArrowUp':moveF=true;break;
    case'KeyS':case'ArrowDown':moveB=true;break;
    case'KeyA':case'ArrowLeft':moveL=true;break;
    case'KeyD':case'ArrowRight':moveR=true;break;
    case'Space':if(canJump){velocity.y=10;canJump=false;}break;
    case'KeyN':setSky(!day);break;
  }
}
function onKeyUp(e){
  switch(e.code){
    case'KeyW':case'ArrowUp':moveF=false;break;
    case'KeyS':case'ArrowDown':moveB=false;break;
    case'KeyA':case'ArrowLeft':moveL=false;break;
    case'KeyD':case'ArrowRight':moveR=false;break;
  }
}

/* === HELPERS === */
function setSky(isDay){
  day=isDay; const col=isDay?0x87c9ff:0x0b0e15;
  scene.background=new THREE.Color(col);
  scene.traverse(o=>{ if(o.isDirectionalLight&&o.name==='SUN') o.intensity=isDay?.9:.15; });
}
function createGift(pos,msg){
  const box=new THREE.Mesh(new THREE.BoxGeometry(1.4,1.4,1.4),
    new THREE.MeshStandardMaterial({color:0xff4d88}));
  const ribbon1=new THREE.Mesh(new THREE.BoxGeometry(1.5,0.15,0.3), new THREE.MeshStandardMaterial({color:0xffffff}));
  const ribbon2=new THREE.Mesh(new THREE.BoxGeometry(0.3,0.15,1.5), new THREE.MeshStandardMaterial({color:0xffffff}));
  ribbon1.position.y=0.7; ribbon2.position.y=0.7;
  box.add(ribbon1); box.add(ribbon2);
  box.position.copy(pos); box.castShadow=true; scene.add(box);
  return {mesh:box,msg,collected:false};
}
function sparkle(origin){
  const geom=new THREE.SphereGeometry(0.06,6,6),group=new THREE.Group();scene.add(group);
  for(let i=0;i<80;i++){const colors=[0xff66cc,0x66ccff,0xffff66,0x99ff99];
    const m=new THREE.MeshBasicMaterial({color:colors[Math.floor(Math.random()*colors.length)],transparent:true,opacity:1});
    const p=new THREE.Mesh(geom,m);p.position.copy(origin);
    p.userData.v=new THREE.Vector3((Math.random()-0.5)*3,Math.random()*3,(Math.random()-0.5)*3);
    group.add(p);}const t0=performance.now();(function tick(){const t=(performance.now()-t0)/1000;
    for(const p of group.children){p.position.addScaledVector(p.userData.v,0.016);p.userData.v.y-=3*0.016;p.material.opacity=Math.max(0,1-t);}if(t<1.2)requestAnimationFrame(tick);else scene.remove(group);})(); }
function chime(){const AC=window.AudioContext||window.webkitAudioContext;if(!AC)return;
  const ac=new AC(),o=ac.createOscillator(),g=ac.createGain();
  o.type='triangle';o.frequency.value=880;g.gain.setValueAtTime(0.0001,ac.currentTime);
  g.gain.exponentialRampToValueAtTime(0.25,ac.currentTime+0.03);
  g.gain.exponentialRampToValueAtTime(0.0001,ac.currentTime+0.5);
  o.connect(g).connect(ac.destination);o.start();o.stop(ac.currentTime+0.55);}
function showMsg(t){const el=document.getElementById('msg');el.textContent=t;el.style.display='block';
  clearTimeout(showMsg.t);showMsg.t=setTimeout(()=>el.style.display='none',3000);}
</script>
</body>
</html>
