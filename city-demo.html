<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Birthday City Demo</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body,html{margin:0;height:100%;overflow:hidden;background:#0e1014;}
  #overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0009}
  #btn{font:600 16px system-ui;padding:12px 18px;border:0;border-radius:10px;cursor:pointer}
  #msg{position:fixed;left:50%;top:40px;transform:translateX(-50%);background:#000b;color:#fff;
       padding:10px 14px;border-radius:10px;font:600 14px system-ui;display:none}
  #cross{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);color:#fff;opacity:.6;font:700 22px monospace}
</style>
</head>
<body>
<div id="overlay"><button id="btn">Enter City Demo ðŸŽ‚</button></div>
<div id="msg"></div>
<div id="cross">+</div>

<script src="three.min.js"></script>

<script>
/* Pointer Lock Controls (inline) */
THREE.PointerLockControls=function(cam,dom){
  const scope=this;this.domElement=dom||document.body;this.isLocked=false;
  const euler=new THREE.Euler(0,0,0,'YXZ'),PI2=Math.PI/2;
  function onMove(e){if(!scope.isLocked)return;
    const mx=e.movementX||0,my=e.movementY||0;
    euler.setFromQuaternion(cam.quaternion);
    euler.y-=mx*0.002;euler.x-=my*0.002;
    euler.x=Math.max(-PI2,Math.min(PI2,euler.x));
    cam.quaternion.setFromEuler(euler);}
  function onPLC(){scope.isLocked=(document.pointerLockElement===scope.domElement);}
  this.lock=()=>this.domElement.requestPointerLock();
  this.unlock=()=>document.exitPointerLock();
  this.connect=()=>{document.addEventListener('mousemove',onMove);document.addEventListener('pointerlockchange',onPLC);}
  this.disconnect=()=>{document.removeEventListener('mousemove',onMove);document.removeEventListener('pointerlockchange',onPLC);}
  this.connect();
};
THREE.PointerLockControls.prototype=Object.create(THREE.EventDispatcher.prototype);

let scene,camera,renderer,controls,raycaster,gift,clock=new THREE.Clock();
let moveF=false,moveB=false,moveL=false,moveR=false,canJump=false,velocity=new THREE.Vector3();
init();animate();

function init(){
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x87ceeb);

  camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,1000);
  camera.position.set(0,1.6,8);

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth,innerHeight);renderer.shadowMap.enabled=true;
  document.body.appendChild(renderer.domElement);

  raycaster=new THREE.Raycaster();

  // lights
  scene.add(new THREE.HemisphereLight(0xffffff,0x444444,0.6));
  let sun=new THREE.DirectionalLight(0xffffff,0.9);sun.position.set(30,50,20);sun.castShadow=true;scene.add(sun);

  // ground
  let ground=new THREE.Mesh(new THREE.PlaneGeometry(200,200),new THREE.MeshStandardMaterial({color:0x3a3a3a}));
  ground.rotation.x=-Math.PI/2;ground.receiveShadow=true;scene.add(ground);

  // building with embedded glass texture
  const glassTex=new THREE.TextureLoader().load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABFklEQVQ4T7XTsUoDQRQF4G9HBAYWIgqLpaWxtbUNrSzt5jEENxDRWKiLQWQg4hBtiMoYgSyV+zmeM5M/O+32vIzljD0+YTQ8kiCCZEX/jKgoG4M1bV5Vw4rGDVq3ASqWWwsfEbhB2z8cwD9CnDo+54v0RNdY8+HEccvoWcDyzqQzXIM1LJD/d4AMMAzXIfC7gCnG/N9HrOMNbc7UPe5dzyOVDLXzmOk2HzizPwOi2LhrVuB+DW9GqaZbsEuMeT7kpG4m/5j5Y9jKx2gdRT+hDkP2xt3gAiHSiqiHrw4gAAAABJRU5ErkJggg==");
  glassTex.wrapS=glassTex.wrapT=THREE.RepeatWrapping;glassTex.repeat.set(5,10);
  glassTex.anisotropy=renderer.capabilities.getMaxAnisotropy();
  let building=new THREE.Mesh(new THREE.BoxGeometry(10,20,10),new THREE.MeshStandardMaterial({map:glassTex}));
  building.position.set(0,10,-15);building.castShadow=true;scene.add(building);

  // hoarding with Guddu smiling photo (base64 embedded placeholder used here)
  const gudduTex=new THREE.TextureLoader().load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAABwklEQVR4nO3cQQ0CMQwEwdr+9+1M0mZtRymUJgUg0vcrJUpfA2AEAAAAAAAAAAAAAAAAAAAAAAOAFwn9dmPlz8uWjS7fIfGvUq2xX9jBdvr4I7Ipc+0fo6VJX/Qar2M53vQ7seFReYEt8Clhdwn1Vtk0qF/KqmqM4SLEssqqx5cUVlByhmQjSuXZBlIoxUvKhO6U4cl1RzqE5PkMjlKsq6Tpy0ruQbS6UmF6lIp1ITlQZFFlOKNRgK6YTxN6XKyLxzCSf+5oqAThuk0pcoKjei9sReZGRFscOOW9S0mOlJloVOQlmkpYZkeRBRMUm1ZIVfZnX8Gv6wZyAyd/UEd0oHZ5i1JfskPlsXyTQ/Zi/3yWhY5B1T+nCRAAAAAAAAAAAAAAAAAAAAAAAABw3y5kgHpV63YgAAAABJRU5ErkJggg==");
  let hoard=new THREE.Mesh(new THREE.PlaneGeometry(8,5),new THREE.MeshBasicMaterial({map:gudduTex}));
  hoard.position.set(0,12,-5);scene.add(hoard);
  let spot=new THREE.SpotLight(0xffffff,1.2);spot.position.set(0,15,5);spot.target=hoard;scene.add(spot);

  // gift
  gift=createGift(new THREE.Vector3(3,1,0),"Happy Birthday Guddu ðŸŽâœ¨");

  // controls
  controls=new THREE.PointerLockControls(camera,document.body);
  document.getElementById('btn').onclick=()=>{controls.lock();document.getElementById('overlay').style.display='none';};
  addEventListener('keydown',onKeyDown);addEventListener('keyup',onKeyUp);addEventListener('click',onClick);
  addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});
}

function animate(){
  requestAnimationFrame(animate);
  const dt=Math.min(0.05,clock.getDelta());
  const dir=new THREE.Vector3((moveR?1:0)-(moveL?1:0),0,(moveB?1:0)-(moveF?1:0)).normalize();
  const speed=10*dt;
  const q=new THREE.Quaternion().setFromEuler(new THREE.Euler(0,camera.rotation.y,0));
  camera.position.add(dir.applyQuaternion(q).multiplyScalar(speed));
  velocity.y-=30*dt;camera.position.y+=velocity.y*dt;
  if(camera.position.y<1.6){camera.position.y=1.6;velocity.y=0;canJump=true;}
  renderer.render(scene,camera);
}

function onKeyDown(e){switch(e.code){
  case'KeyW':moveF=true;break;case'KeyS':moveB=true;break;case'KeyA':moveL=true;break;case'KeyD':moveR=true;break;
  case'Space':if(canJump){velocity.y=10;canJump=false;}break;}}

function onKeyUp(e){switch(e.code){
  case'KeyW':moveF=false;break;case'KeyS':moveB=false;break;case'KeyA':moveL=false;break;case'KeyD':moveR=false;break;}}

function onClick(){
  raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
  let hit=raycaster.intersectObject(gift.mesh);
  if(hit.length>0&&!gift.collected){gift.collected=true;scene.remove(gift.mesh);sparkle(hit[0].point);showMsg(gift.msg);}
}

function createGift(pos,msg){
  const box=new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new THREE.MeshStandardMaterial({color:0xff4d88}));
  const r1=new THREE.Mesh(new THREE.BoxGeometry(1.3,0.1,0.3),new THREE.MeshStandardMaterial({color:0xffffff}));
  const r2=new THREE.Mesh(new THREE.BoxGeometry(0.3,0.1,1.3),new THREE.MeshStandardMaterial({color:0xffffff}));
  r1.position.y=0.6;r2.position.y=0.6;box.add(r1);box.add(r2);
  box.position.copy(pos);box.castShadow=true;scene.add(box);
  return {mesh:box,msg,collected:false};
}

function sparkle(origin){
  const geom=new THREE.SphereGeometry(0.06,6,6),grp=new THREE.Group();scene.add(grp);
  for(let i=0;i<60;i++){const colors=[0xff66cc,0x66ccff,0xffff66,0x99ff99];
    const mat=new THREE.MeshBasicMaterial({color:colors[Math.floor(Math.random()*colors.length)],transparent:true,opacity:1});
    const p=new THREE.Mesh(geom,mat);p.position.copy(origin);
    p.userData.v=new THREE.Vector3((Math.random()-0.5)*3,Math.random()*3,(Math.random()-0.5)*3);grp.add(p);}
  const t0=performance.now();(function tick(){const t=(performance.now()-t0)/1000;
    for(const p of grp.children){p.position.addScaledVector(p.userData.v,0.016);p.userData.v.y-=3*0.016;p.material.opacity=Math.max(0,1-t);}
    if(t<1.2)requestAnimationFrame(tick);else scene.remove(grp);})();}

function showMsg(t){const el=document.getElementById('msg');el.textContent=t;el.style.display='block';
  clearTimeout(showMsg.t);showMsg.t=setTimeout(()=>el.style.display='none',3000);}
</script>
</body>
</html>
