<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Guddu ‚Äî Magical Birthday Show ‚ú®</title>
<meta name="description" content="A 100-second mobile-friendly sky show for Guddu: stars forming text, shooting stars, balloons, aurora, compliments, secret letter, fireworks messages, shimmering finale ‚Äî with music and gentle fade-out.">
<style>
  :root{
    --ink:#eef2ff; --muted:#c8d1ff; --deep:#030616; --deep2:#0a0f2b;
    --rose:#ff92dc; --gold:#ffd98a; --aqua:#89f3ff; --vio:#c0a2ff; --mint:#9ff9cf;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, Georgia, "Times New Roman";
    background: radial-gradient(1200px 800px at 10% -10%, #1b1652 0%, #0b0f2b 45%, #030616 85%);
    overflow:hidden; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
  }

  /* Ambient aurora glow (soft background blurs) */
  .aurora{position:fixed; inset:-18% -10% -10% -10%; z-index:0; filter: blur(44px) saturate(120%); pointer-events:none}
  .a{position:absolute; width:70vw; height:70vw; border-radius:50%; mix-blend-mode:screen;}
  .a1{left:-8vw; top:-6vh; background: radial-gradient(circle, #3ae1ff60, #6a54ff36, #0000 70%); animation: drift 18s ease-in-out infinite}
  .a2{right:-14vw; top:10vh; background: radial-gradient(circle, #ff54d455, #ffe28f33, #0000 70%); animation: drift 24s ease-in-out infinite reverse}
  .a3{left:22vw; bottom:-12vh; background: radial-gradient(circle, #79ffbe55, #7ea2ff33, #0000 70%); animation: drift 22s ease-in-out infinite}
  @keyframes drift{0%,100%{transform:translateY(0)}50%{transform:translateY(-2.5vh)}}

  /* Subtle starry background (always on) */
  #sky{position:fixed; inset:0; z-index:1; display:block; width:100%; height:100%}

  /* Stage & scenes */
  .stage{position:fixed; inset:0; display:grid; place-items:center; z-index:2}
  .scene{position:absolute; inset:0; opacity:0; pointer-events:none; transition:opacity 900ms ease}
  .scene.live{opacity:1; pointer-events:auto}
  canvas.scene-cv{display:block; width:100%; height:100%}

  /* Header banner */
  .banner{position:absolute; top:10px; left:50%; transform:translateX(-50%);
    background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.07));
    border:1px solid rgba(255,255,255,.18); padding:6px 12px; border-radius:999px;
    font-weight:800; letter-spacing:.2px; font-size:12px; opacity:.9; z-index:3
  }

  /* Professional warm message styling (twinkling, bold, elegant) */
  .msgWrap{position:absolute; left:50%; transform:translateX(-50%); max-width:min(92vw, 880px); text-align:center; padding:0 4vw; z-index:4}
  .pos-bottom{bottom:30px}
  .pos-top{top:36px}
  .pos-center{top:50%; transform:translate(-50%, -50%)}
  .pos-below-center{bottom:18vh}
  .pos-above-bottom{bottom:18vh}
  .msg{
    font-family: Georgia, "Times New Roman", ui-serif, system-ui;
    font-weight:900; letter-spacing:.3px;
    font-size:clamp(22px, 6vw, 50px);
    line-height:1.2;
    color:#fff;
    text-shadow:
      0 0 10px rgba(255,255,255,.35),
      0 0 30px rgba(255,200,230,.25),
      0 0 60px rgba(255,200,230,.18);
    animation:floaty 6s ease-in-out infinite, twinkle 2.4s linear infinite;
  }
  .msg.gold{ text-shadow:
      0 0 10px rgba(255,240,180,.55),
      0 0 30px rgba(255,200,120,.35),
      0 0 70px rgba(255,200,120,.25); }
  .msg.rose{ text-shadow:
      0 0 10px rgba(255,160,220,.55),
      0 0 30px rgba(255,120,200,.35),
      0 0 70px rgba(255,120,200,.25); }
  .msg.violet{ text-shadow:
      0 0 10px rgba(200,170,255,.55),
      0 0 30px rgba(180,140,255,.35),
      0 0 70px rgba(180,140,255,.25); }
  .msg.mint{ text-shadow:
      0 0 10px rgba(170,255,220,.55),
      0 0 30px rgba(140,255,210,.35),
      0 0 70px rgba(140,255,210,.25); }
  .sub{
    margin-top:10px; font-size:clamp(14px, 3.8vw, 20px); color:var(--muted);
    text-shadow:0 0 14px rgba(255,255,255,.18);
  }
  @keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
  @keyframes twinkle{0%,100%{opacity:1} 40%{opacity:.85} 60%{opacity:1} 80%{opacity:.9}}

  /* Compliments orb */
  .orb{position:absolute; width:min(64vw, 380px); aspect-ratio:1; border-radius:50%;
    left:50%; top:48%; transform:translate(-50%,-50%);
    background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.98), rgba(180,215,255,.82) 40%, rgba(120,160,255,.5) 65%, rgba(60,90,220,.28) 80%, rgba(30,40,120,.12));
    border:1px solid rgba(255,255,255,.55);
    box-shadow:0 0 110px rgba(160,200,255,.6), inset 0 0 60px rgba(255,255,255,.9);
    display:grid; place-items:center; text-align:center; padding:24px; color:#0c1c3a; font-weight:900; letter-spacing:.3px; font-size:clamp(16px,3.8vw,22px);
  }

  /* Secret letter */
  .letterWrap{position:absolute; inset:0; display:grid; place-items:center}
  .paper{
    width:min(92vw,780px); min-height:48vh; padding:22px 18px; line-height:1.75;
    background:linear-gradient(180deg,#fff,#f7fbff); color:#0b1a35; border-radius:14px;
    border:1px solid rgba(0,0,0,.06); box-shadow:0 35px 80px rgba(0,0,0,.35);
    transform:perspective(1200px) rotateX(6deg) translateY(6px); opacity:.98;
    font-size:clamp(14px, 3.6vw, 18px)
  }
  .caret{display:inline-block; width:10px; height:1.1em; background:currentColor; animation:blink 1s steps(2,start) infinite}
  @keyframes blink{50%{opacity:0}}

  /* Music control pill */
  .music-pill{position:fixed; bottom:14px; left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,.42); border:1px solid rgba(255,255,255,.22); border-radius:999px;
    padding:6px 12px; font-size:.95rem; display:flex; gap:10px; align-items:center;
    box-shadow:0 10px 28px rgba(0,0,0,.35); z-index:5; backdrop-filter:blur(4px)
  }
  .music-pill button{background:transparent; border:none; color:var(--ink); cursor:pointer; font-weight:800}
  .hidden{display:none}

  /* Finale shimmer & idle hearts */
  .shimmer {
    background: linear-gradient(90deg, #fff, #ff66cc, #fff);
    background-size: 300% 100%;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: shimmer 4s infinite;
    text-shadow:none;
  }
  @keyframes shimmer { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
  .idleHeart{position:fixed; font-size:clamp(16px,5vw,24px); opacity:.85; pointer-events:none; z-index:3}
</style>
</head>
<body>
  <!-- Ambient glows -->
  <div class="aurora" aria-hidden="true"><div class="a a1"></div><div class="a a2"></div><div class="a a3"></div></div>

  <!-- Continuous subtle twinkling sky -->
  <canvas id="sky"></canvas>

  <div class="stage">
    <div class="banner">A Night of Surprises for Guddu ‚ú®</div>

    <!-- SCENE 1: Intro -->
    <section class="scene live" id="scene-intro">
      <div class="msgWrap pos-center">
        <div class="msg rose">Here are the cute surprises for the cutest Guddu üíñ</div>
        <div class="sub">Sit back and enjoy‚Ä¶</div>
      </div>
    </section>

    <!-- SCENE 2: Stars form text -->
    <section class="scene" id="scene-startext">
      <canvas id="cv-startext" class="scene-cv"></canvas>
      <div class="msgWrap pos-below-center">
        <div class="msg gold">Happy Birthday, Guddu ‚ú®</div>
        <div class="sub">Your smile lights up the universe</div>
      </div>
    </section>

    <!-- SCENE 3: Shooting stars -->
    <section class="scene" id="scene-shoot">
      <canvas id="cv-shoot" class="scene-cv"></canvas>
      <div class="msgWrap pos-top">
        <div class="msg violet">Every wish I make is for your happiness</div>
      </div>
    </section>

    <!-- SCENE 4: Balloons & Hearts -->
    <section class="scene" id="scene-hearts">
      <canvas id="cv-hearts" class="scene-cv"></canvas>
      <div class="msgWrap pos-bottom">
        <div class="msg rose">Endless love floating your way üíï</div>
      </div>
    </section>

    <!-- SCENE 5: Aurora waves -->
    <section class="scene" id="scene-aurora">
      <canvas id="cv-aurora" class="scene-cv"></canvas>
      <div class="msgWrap pos-top">
        <div class="msg mint">Life is more colorful with you in it</div>
      </div>
    </section>

    <!-- SCENE 6: Compliments mirror -->
    <section class="scene" id="scene-mirror">
      <div class="orb" id="orb">You are starlight ‚ú®</div>
      <div class="msgWrap pos-above-bottom">
        <div class="msg gold">Words can‚Äôt capture your magic</div>
      </div>
    </section>

    <!-- SCENE 7: Secret letter -->
    <section class="scene" id="scene-letter">
      <div class="letterWrap"><div class="paper"><div id="typeArea"></div></div></div>
      <div class="msgWrap pos-bottom">
        <div class="msg violet">From my heart to yours üíå</div>
      </div>
    </section>

    <!-- SCENE 8: Fireworks phrases -->
    <section class="scene" id="scene-fire">
      <canvas id="cv-fire" class="scene-cv"></canvas>
      <div class="msgWrap pos-top">
        <div class="msg rose">You are loved, today and always üéÜ</div>
      </div>
    </section>

    <!-- SCENE 9: Finale message -->
    <section class="scene" id="scene-finale">
      <div class="msgWrap pos-center">
        <div class="msg shimmer">Guddu, you are the most special part of our lives üíñ<br/>Forever with love, always.</div>
      </div>
    </section>
  </div>

  <!-- Music (your link, autoplay with fallback + fade) -->
  <audio id="bgm" src="https://github.com/Anuj1-web/Guddu-birthday-special/raw/refs/heads/main/hum%20marjayenge.mp3" preload="auto" autoplay playsinline></audio>
  <div id="musicCtl" class="music-pill">
    <span id="musicLabel">Sound: On</span>
    <button id="toggleMusic" aria-label="Toggle Sound">‚è∏Ô∏é</button>
    <button id="tapForSound" class="hidden">Tap for sound üéµ</button>
  </div>

  <!-- Optional light libs: GSAP for smooth ending hearts, particles.js for star twinkles -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

<script>
/* ================== UTILITIES ================== */
const $=(s,el=document)=>el.querySelector(s);
const $$=(s,el=document)=>[...el.querySelectorAll(s)];
const rnd=(a,b)=>Math.random()*(b-a)+a;
const rInt=(a,b)=>Math.floor(rnd(a,b));
function fitCanvas(c){
  const dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
  const w = innerWidth, h = innerHeight;
  c.width = Math.floor(w * dpr);
  c.height = Math.floor(h * dpr);
  const ctx = c.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return {ctx, w, h, dpr};
}

/* ================== STAR SKY BACKGROUND ================== */
(function initSky(){
  const c=$('#sky'); let pack=fitCanvas(c); let ctx=pack.ctx, w=pack.w, h=pack.h;
  addEventListener('resize', ()=>{ pack=fitCanvas(c); ctx=pack.ctx; w=pack.w; h=pack.h; });
  const stars=Array.from({length:650},()=>({x:rnd(0,w), y:rnd(0,h), r:rnd(.6,1.8), tw:rnd(0,6.28), hue:rInt(190,330)}));
  const dust=Array.from({length:30},()=>({x:rnd(0,w), y:rnd(0,h), vx:rnd(-.06,.06), vy:rnd(-.03,.03), a:rnd(.05,.2)}));
  (function loop(){
    ctx.clearRect(0,0,w,h);
    const g=ctx.createRadialGradient(w*0.5,h*0.2,10, w*0.5,h*0.2, Math.max(w,h));
    g.addColorStop(0,'#15183f'); g.addColorStop(1,'#050716'); ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
    for(const s of stars){
      s.tw+=.02; ctx.beginPath(); ctx.globalAlpha=(Math.sin(s.tw)+1)/3+.22;
      ctx.fillStyle=`hsl(${s.hue}, 90%, 85%)`; ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
    }
    for(const d of dust){
      d.x+=d.vx; d.y+=d.vy;
      if(d.x<-40) d.x=w+40; if(d.x>w+40) d.x=-40; if(d.y<-40) d.y=h+40; if(d.y>h+40) d.y=-40;
      const rr=rnd(30,80); const gr=ctx.createRadialGradient(d.x,d.y,0,d.x,d.y,rr);
      gr.addColorStop(0,`rgba(255,255,255,${d.a})`); gr.addColorStop(1,'rgba(255,255,255,0)');
      ctx.fillStyle=gr; ctx.beginPath(); ctx.arc(d.x,d.y,rr,0,Math.PI*2); ctx.fill();
    }
    requestAnimationFrame(loop);
  })();
})();

/* ================== MUSIC (autoplay + fallback + fade) ================== */
const bgm=$('#bgm'), musicLabel=$('#musicLabel'),
      toggleBtn=$('#toggleMusic'), tapForSound=$('#tapForSound');

async function startMusic(){
  try{
    bgm.muted=true; // allow autoplay on mobile
    await bgm.play();
    setTimeout(()=>{ bgm.muted=false; musicLabel.textContent='Sound: On'; toggleBtn.textContent='‚è∏Ô∏é'; }, 200);
  }catch(e){
    tapForSound.classList.remove('hidden');
    musicLabel.textContent='Sound: Off';
    toggleBtn.textContent='‚ñ∂Ô∏é';
  }
}
startMusic();

toggleBtn.addEventListener('click', async ()=>{
  if(bgm.paused){
    try{ await bgm.play(); bgm.muted=false; musicLabel.textContent='Sound: On'; toggleBtn.textContent='‚è∏Ô∏é'; tapForSound.classList.add('hidden'); }catch(e){}
  } else {
    bgm.pause(); musicLabel.textContent='Sound: Off'; toggleBtn.textContent='‚ñ∂Ô∏é';
  }
});
tapForSound.addEventListener('click', async ()=>{
  try{ await bgm.play(); bgm.muted=false; musicLabel.textContent='Sound: On'; tapForSound.classList.add('hidden'); toggleBtn.textContent='‚è∏Ô∏é'; }catch(e){}
});
document.addEventListener('visibilitychange', ()=>{ if(!document.hidden && bgm.paused){ bgm.play().catch(()=>{}); }});
function fadeMusicOut(ms){
  const startVol=Math.min(1, bgm.volume || 1);
  const t0=performance.now();
  (function f(t){
    const k=Math.min(1,(t-t0)/ms); bgm.volume=startVol*(1-k);
    if(k<1) requestAnimationFrame(f); else { bgm.volume=0; bgm.pause(); }
  })(performance.now());
}

/* ================== TIMELINE (‚âà 100s) ================== */
const SCENES=[
  { id:'scene-intro',    dur: 8000 },   // 0-8
  { id:'scene-startext', dur: 12000 },  // 8-20
  { id:'scene-shoot',    dur: 9000 },   // 20-29
  { id:'scene-hearts',   dur: 10000 },  // 29-39
  { id:'scene-aurora',   dur: 10000 },  // 39-49
  { id:'scene-mirror',   dur: 9000 },   // 49-58
  { id:'scene-letter',   dur: 14000 },  // 58-72
  { id:'scene-fire',     dur: 18000 },  // 72-90
  { id:'scene-finale',   dur: 12000 }   // 90-102 (music fades out)
];
let step=0, timer=null, started=new Set();
function showScene(i){
  $$('.scene').forEach(s=>s.classList.remove('live'));
  const item=SCENES[i], el=$('#'+item.id);
  el.classList.add('live');
  if(!started.has(item.id)){ initScene(item.id); started.add(item.id); }
  clearTimeout(timer);
  timer=setTimeout(()=>{
    step=(step+1)%SCENES.length;
    showScene(step);
    if(step===SCENES.length-1){ fadeMusicOut(6500); spawnIdleHearts(); }
  }, item.dur);
}
document.addEventListener('DOMContentLoaded', ()=>showScene(0));

/* ================== SCENE DISPATCH ================== */
function initScene(id){
  const map={
    'scene-startext': initStarText,
    'scene-shoot': initShoot,
    'scene-hearts': initHearts,
    'scene-aurora': initAurora,
    'scene-mirror': initMirror,
    'scene-letter': initLetter,
    'scene-fire': initFire,
    'scene-finale': initFinale
  };
  if(map[id]) map[id]();
}

/* ================== SCENE 2: Stars form text ================== */
function initStarText(){
  const c=$('#cv-startext'); let pack=fitCanvas(c); let ctx=pack.ctx, w=pack.w, h=pack.h;
  addEventListener('resize', ()=>{ pack=fitCanvas(c); ctx=pack.ctx; w=pack.w; h=pack.h; buildTargets(); });
  const particles=Array.from({length:900},()=>({x:rnd(0,w), y:rnd(0,h), vx:0, vy:0, hue:rInt(200,340)}));
  let targets=[];
  function buildTargets(){
    const oc=document.createElement('canvas'); const octx=oc.getContext('2d');
    oc.width=w; oc.height=h; octx.clearRect(0,0,w,h);
    octx.fillStyle='#fff';
    const size=Math.max(28, Math.min(62, w/12));
    octx.font=`900 ${size}px system-ui, -apple-system, Segoe UI, Roboto`;
    octx.textAlign='center'; octx.textBaseline='middle';
    octx.fillText('HAPPY BIRTHDAY GUDDU', w/2, h*0.45);
    const img=octx.getImageData(0,0,w,h).data;
    const gap=Math.max(3, Math.floor(w/420));
    const pts=[];
    for(let y=0;y<h;y+=gap){
      for(let x=0;x<w;x+=gap){
        const a=img[(y*w+x)*4+3]; if(a>200) pts.push({x,y});
      }
    }
    targets=[]; for(let i=0;i<particles.length;i++) targets.push(pts[rInt(0,pts.length)]);
  }
  buildTargets();
  (function loop(){
    ctx.fillStyle='rgba(5,6,18,.22)'; ctx.fillRect(0,0,w,h);
    for(let i=0;i<particles.length;i++){
      const p=particles[i], t=targets[i];
      const ax=(t.x - p.x)*0.024, ay=(t.y - p.y)*0.024;
      p.vx=(p.vx+ax)*0.9; p.vy=(p.vy+ay)*0.9; p.x+=p.vx; p.y+=p.vy;
      ctx.beginPath(); ctx.globalAlpha=.95; ctx.fillStyle=`hsl(${p.hue},90%,70%)`;
      ctx.arc(p.x,p.y,1.35,0,Math.PI*2); ctx.fill();
    }
    requestAnimationFrame(loop);
  })();
}

/* ================== SCENE 3: Shooting stars ================== */
function initShoot(){
  const c=$('#cv-shoot'); let pack=fitCanvas(c); let ctx=pack.ctx, w=pack.w, h=pack.h;
  addEventListener('resize', ()=>{ pack=fitCanvas(c); ctx=pack.ctx; w=pack.w; h=pack.h; });
  const trails=[];
  function addTrail(){
    const y=rnd(h*0.25,h*0.6), dir=Math.random()<.5?1:-1;
    const x=dir===1?-50:w+50, vx=dir*rnd(5,7), vy=rnd(-1.2,1.2);
    const life=rInt(70,110); trails.push({x,y,vx,vy,life});
  }
  for(let i=0;i<14;i++) setTimeout(addTrail, i*600);
  (function loop(){
    ctx.fillStyle='rgba(5,6,18,.25)'; ctx.fillRect(0,0,w,h);
    for(let i=trails.length-1;i>=0;i--){
      const t=trails[i];
      t.x+=t.vx; t.y+=t.vy; t.life--;
      const lg=ctx.createLinearGradient(t.x,t.y,t.x-t.vx*12,t.y-t.vy*12);
      lg.addColorStop(0,'rgba(255,255,255,.95)'); lg.addColorStop(1,'rgba(255,255,255,0)');
      ctx.strokeStyle=lg; ctx.lineWidth=2; ctx.beginPath();
      ctx.moveTo(t.x,t.y); ctx.lineTo(t.x-t.vx*14,t.y-t.vy*14); ctx.stroke();
      ctx.beginPath(); ctx.fillStyle='#fff'; ctx.globalAlpha=1; ctx.arc(t.x,t.y,2.2,0,Math.PI*2); ctx.fill();
      if(t.life<=0) trails.splice(i,1);
    }
    requestAnimationFrame(loop);
  })();
}

/* ================== SCENE 4: Hearts & Balloons ================== */
function initHearts(){
  const c=$('#cv-hearts'); let pack=fitCanvas(c); let ctx=pack.ctx, w=pack.w, h=pack.h;
  addEventListener('resize', ()=>{ pack=fitCanvas(c); ctx=pack.ctx; w=pack.w; h=pack.h; });
  const items=[]; const parts=[];
  function addHeart(){
    const x=rnd(w*0.15, w*0.85), size=rnd(10,16), vy=rnd(-1.6,-0.9), rot=rnd(-.02,.02);
    items.push({type:'heart', x, y:h+40, size, vy, rot});
  }
  function addBalloon(){
    const x=rnd(w*0.15, w*0.85), vy=rnd(-1.1,-0.7), hue=rInt(0,360);
    items.push({type:'balloon', x, y:h+60, vy, hue, burst:false, t:0});
  }
  function drawHeart(x,y,s,rot){
    ctx.save(); ctx.translate(x,y); ctx.rotate(rot);
    ctx.beginPath();
    ctx.moveTo(0,-s*0.2);
    ctx.bezierCurveTo(-s,-s, -s*1.6, s*0.4, 0, s*1.4);
    ctx.bezierCurveTo(s*1.6, s*0.4, s, -s, 0, -s*0.2);
    const g=ctx.createLinearGradient(0,-s,0,s*1.4);
    g.addColorStop(0,'#ff9adf'); g.addColorStop(1,'#ff4fb9');
    ctx.fillStyle=g; ctx.fill(); ctx.restore();
  }
  function drawBalloon(x,y,hue){
    ctx.save(); ctx.translate(x,y);
    ctx.beginPath(); ctx.ellipse(0,0,14,18,0,0,Math.PI*2);
    ctx.fillStyle=`hsl(${hue},90%,65%)`; ctx.fill();
    ctx.beginPath(); ctx.moveTo(0,18); ctx.lineTo(0,34);
    ctx.strokeStyle=`hsl(${hue},60%,75%)`; ctx.lineWidth=1.2; ctx.stroke();
    ctx.restore();
  }
  function burst(x,y,hue){
    for(let i=0;i<90;i++){
      parts.push({x,y,vx:Math.cos(i/90*Math.PI*2)*rnd(1.6,2.6), vy:Math.sin(i/90*Math.PI*2)*rnd(1.6,2.6), life:rInt(50,80), color:`hsl(${hue},90%,70%)`});
    }
  }
  for(let i=0;i<20;i++) setTimeout(addHeart, i*300);
  for(let i=0;i<12;i++) setTimeout(addBalloon, 800+i*650);

  (function loop(){
    ctx.fillStyle='rgba(5,6,18,.25)'; ctx.fillRect(0,0,w,h);
    for(const it of items){
      if(it.type==='heart'){ it.y+=it.vy; it.rot+=rnd(-.002,.002); drawHeart(it.x,it.y,it.size,it.rot); }
      else{ it.y+=it.vy; it.t++; drawBalloon(it.x,it.y,it.hue); if(!it.burst && it.t>rInt(70,120)){ it.burst=true; burst(it.x,it.y-2,it.hue); } }
    }
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=.02; p.life--;
      ctx.beginPath(); ctx.globalAlpha=Math.max(0,p.life/80); ctx.fillStyle=p.color; ctx.arc(p.x,p.y,1.7,0,Math.PI*2); ctx.fill();
      if(p.life<=0) parts.splice(i,1);
    }
    requestAnimationFrame(loop);
  })();
}

/* ================== SCENE 5: Aurora waves ================== */
function initAurora(){
  const c=$('#cv-aurora'); let pack=fitCanvas(c); let ctx=pack.ctx, w=pack.w, h=pack.h;
  addEventListener('resize', ()=>{ pack=fitCanvas(c); ctx=pack.ctx; w=pack.w; h=pack.h; });
  const waves=Array.from({length:5},(_,i)=>({y:h*0.4+i*40, t:rnd(0,10), hue:180+i*30}));
  (function loop(){
    ctx.clearRect(0,0,w,h);
    for(const a of waves){
      a.t+=.015;
      const path=[];
      for(let x=0;x<=w;x+=24){
        const y = h*0.6 + Math.sin(x*0.004 + a.t)*30 + Math.sin(x*0.002+a.t*1.4)*18;
        path.push({x,y});
      }
      const grd=ctx.createLinearGradient(0,a.y,w,a.y);
      grd.addColorStop(0,`hsla(${a.hue}, 90%, 70%, .10)`);
      grd.addColorStop(1,`hsla(${a.hue+60}, 90%, 65%, .12)`);
      ctx.fillStyle=grd;
      ctx.beginPath(); ctx.moveTo(0,h);
      for(const p of path) ctx.lineTo(p.x,p.y);
      ctx.lineTo(w,h); ctx.closePath(); ctx.fill();
    }
    requestAnimationFrame(loop);
  })();
}

/* ================== SCENE 6: Compliments mirror ================== */
function initMirror(){
  const orb=$('#orb');
  const lines=[
    'Most beautiful smile ‚ú®',
    'Kindest heart üíñ',
    'You light up my world üåü',
    'You are my favorite miracle üîÆ',
    'Unstoppable, brilliant, loved üí´'
  ];
  let i=0;
  setInterval(()=>{
    i=(i+1)%lines.length; orb.textContent=lines[i];
    orb.style.boxShadow='0 0 110px rgba(255,255,255,.95), inset 0 0 60px rgba(255,255,255,.9)';
    setTimeout(()=>orb.style.boxShadow='0 0 110px rgba(160,200,255,.6), inset 0 0 60px rgba(255,255,255,.9)',420);
  }, 1600);
}

/* ================== SCENE 7: Secret letter (auto-type) ================== */
function initLetter(){
  const area=$('#typeArea');
  const text=`My dearest Guddu,

Tonight the sky is brighter‚Äîbecause it carries my wish for you.
Thank you for your kindness, your laughter, and the magic you bring.

I wish you calm mornings, brave dreams, and a thousand reasons to smile.
I‚Äôm grateful for you today and every day.

Happy Birthday, my star.
Always yours. üíñ`;
  let i=0; function render(){ area.innerHTML=`<span>${text.slice(0,i).replace(/\n/g,'<br>')}</span><span class="caret"></span>`;}
  render();
  const speed=22; const t=setInterval(()=>{ i++; render(); if(i>=text.length) clearInterval(t); }, speed);
}

/* ================== SCENE 8: Fireworks phrases ================== */
function initFire(){
  const c=$('#cv-fire'); let pack=fitCanvas(c); let ctx=pack.ctx, w=pack.w, h=pack.h;
  addEventListener('resize', ()=>{ pack=fitCanvas(c); ctx=pack.ctx; w=pack.w; h=pack.h; });
  const parts=[];
  function boom(x,y,hue){
    for(let i=0;i<170;i++){
      const a=Math.PI*2*(i/170)+rnd(-.02,.02); const s=rnd(2.2,3.4);
      parts.push({x,y,vx:Math.cos(a)*s*rnd(.6,1.4), vy:Math.sin(a)*s*rnd(.6,1.4), life:rInt(70,100), color:`hsl(${hue},90%,60%)`});
    }
  }
  let t=0;
  const words=['HAPPY BIRTHDAY','GUDDU','YOU ARE LOVED','FOREVER SPECIAL','MY STAR'];
  const seq=setInterval(()=>{
    boom(rnd(w*.25,w*.75), rnd(h*.35,h*.6), rInt(0,360));
    t++;
    // write a word every few booms
    if(t%3===0){
      ctx.save(); ctx.fillStyle='rgba(255,255,255,.98)'; ctx.font=`900 ${Math.max(28, w/10)}px system-ui`;
      ctx.textAlign='center'; ctx.textBaseline='middle';
      const word=words[(t/3-1)%words.length];
      ctx.fillText(word, w/2, h*.5);
      ctx.restore();
    }
    if(t>12) clearInterval(seq);
  }, 900);

  (function loop(){
    ctx.fillStyle='rgba(5,6,16,.22)'; ctx.fillRect(0,0,w,h);
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=.02; p.life--;
      ctx.beginPath(); ctx.fillStyle=p.color; ctx.globalAlpha=Math.max(0,p.life/100);
      ctx.arc(p.x,p.y,1.8,0,Math.PI*2); ctx.fill();
      if(p.life<=0) parts.splice(i,1);
    }
    requestAnimationFrame(loop);
  })();
}

/* ================== SCENE 9: Finale ================== */
function initFinale(){
  // Idle hearts spawned below; shimmer text already in DOM.
}

/* ================== IDLE HEARTS AFTER FINALE ================== */
function spawnIdleHearts(){
  function addHeart(){
    const el=document.createElement('div');
    el.className='idleHeart';
    el.textContent=Math.random()<.5?'üíñ':'‚ú®';
    el.style.left=rInt(8,92)+'vw';
    el.style.top=rInt(60,88)+'vh';
    document.body.appendChild(el);
    const dur=rnd(5,9);
    gsap.fromTo(el,{y:0,opacity:0.0,scale:0.8},{y:-rInt(30,80),opacity:1,scale:1,duration:dur/2,ease:"power2.out",
      onComplete:()=>gsap.to(el,{y:-rInt(90,140),opacity:0.0,duration:dur/2,ease:"power2.in",onComplete:()=>el.remove()})
    });
  }
  setInterval(addHeart, 1200);
}

/* ================== PARTICLES.JS (twinkling stars behind everything) ================== */
particlesJS("sky", {
  "particles": {
    "number": { "value": 80, "density": { "enable": true, "value_area": 900 }},
    "color": { "value": "#ffffff" },
    "shape": { "type": "circle" },
    "opacity": { "value": 0.6, "random": true },
    "size": { "value": 1.8, "random": true },
    "move": { "enable": true, "speed": 0.4 }
  },
  "interactivity": { "events": { "onhover": { "enable": false }, "onclick": { "enable": false }}},
  "retina_detect": true
});
</script>
</body>
</html>
